<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#000000" id="theme-meta">
<meta name="mobile-web-app-capable" content="true">
<meta name="apple-mobile-web-app-capable" content="true">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="TrnX">
<title>TrnX</title>
<link rel="manifest" href="/TrnX/manifest.json">
<link rel="apple-touch-icon" href="/TrnX/apple-touch-icon.png">
<link href="https://fonts.googleapis.com/css2?family=Figtree:wght@300;400;500;600;700;800;900&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TrnX Â· Apple Healthâ€“Inspired Design System
   Figtree + DM Sans Â· Warm Neutrals Â· Coral Accent
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

@keyframes fadeUp    { from{opacity:0;transform:translateY(14px)} to{opacity:1;transform:translateY(0)} }
@keyframes scaleIn   { from{opacity:0;transform:scale(.94)} to{opacity:1;transform:scale(1)} }
@keyframes ringFill  { from{stroke-dashoffset:var(--dash-total)} to{stroke-dashoffset:var(--dash-offset)} }
@keyframes shimmer   { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
@keyframes pulse     { 0%,100%{opacity:1} 50%{opacity:.45} }
@keyframes slideUp   { from{transform:translateY(100%)} to{transform:translateY(0)} }

:root {
  /* Accent â€” warm coral (Apple Activity ring inspired) */
  --accent:       #FF6B6B;
  --accent-deep:  #E84040;
  --accent-soft:  rgba(255,107,107,.12);
  --accent-glow:  rgba(255,107,107,.25);

  /* Secondary accents */
  --green:  #30D158;
  --blue:   #0A84FF;
  --amber:  #FFD60A;
  --teal:   #5AC8FA;

  /* Motion */
  --spring: cubic-bezier(.32,.72,0,1);
  --ease:   cubic-bezier(.4,0,.2,1);
  --bounce: cubic-bezier(.34,1.56,.64,1);

  /* Radius */
  --r-sm:  10px;
  --r-md:  16px;
  --r-lg:  22px;
  --r-xl:  28px;
}

/* â”€â”€ DARK THEME â”€â”€ */
[data-theme="dark"] {
  --bg:          #000000;
  --bg2:         #0C0C0E;
  --bg3:         #111115;
  --card:        #1C1C1E;
  --card2:       #242428;
  --card3:       #2C2C30;
  --border:      rgba(255,255,255,.08);
  --border2:     rgba(255,255,255,.14);
  --border3:     rgba(255,255,255,.06);
  --text:        #FFFFFF;
  --text2:       rgba(255,255,255,.70);
  --text3:       rgba(255,255,255,.40);
  --text4:       rgba(255,255,255,.18);
  --fill:        rgba(255,255,255,.06);
  --fill2:       rgba(255,255,255,.10);
  --fill3:       rgba(255,255,255,.04);
  --nav-bg:      rgba(10,10,14,.88);
  --header-bg:   rgba(0,0,0,.80);
  --sheet-bg:    #1C1C1E;
  --shadow-lg:   0 20px 60px rgba(0,0,0,.85);
  --shadow-sm:   0 4px 16px rgba(0,0,0,.5);
  --blur:        backdrop-filter:blur(24px) saturate(180%);
}

/* â”€â”€ LIGHT THEME â”€â”€ */
[data-theme="light"] {
  --bg:          #F2F2F7;
  --bg2:         #FFFFFF;
  --bg3:         #F9F9FB;
  --card:        #FFFFFF;
  --card2:       #F2F2F7;
  --card3:       #E5E5EA;
  --border:      rgba(0,0,0,.07);
  --border2:     rgba(0,0,0,.12);
  --border3:     rgba(0,0,0,.04);
  --text:        #000000;
  --text2:       rgba(0,0,0,.65);
  --text3:       rgba(0,0,0,.40);
  --text4:       rgba(0,0,0,.18);
  --fill:        rgba(0,0,0,.04);
  --fill2:       rgba(0,0,0,.08);
  --fill3:       rgba(0,0,0,.02);
  --nav-bg:      rgba(242,242,247,.88);
  --header-bg:   rgba(242,242,247,.80);
  --sheet-bg:    #F2F2F7;
  --shadow-lg:   0 20px 60px rgba(0,0,0,.15);
  --shadow-sm:   0 4px 16px rgba(0,0,0,.08);
}

/* â”€â”€ BASE â”€â”€ */
*,*::before,*::after { box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent }
html,body {
  width:100%;max-width:430px;margin:0 auto;height:100%;overflow:hidden;
  background:var(--bg);
  font-family:'Figtree','DM Sans',-apple-system,sans-serif;
  color:var(--text);-webkit-font-smoothing:antialiased;
}
#app { display:flex;flex-direction:column;height:100dvh;overflow:hidden;position:relative }

/* â”€â”€ PAGES â”€â”€ */
.page {
  display:none;flex-direction:column;flex:1;
  overflow-y:auto;overflow-x:hidden;
  padding-bottom:calc(90px + env(safe-area-inset-bottom,0px));
  scrollbar-width:none;
}
.page::-webkit-scrollbar { display:none }
.page.active { display:flex }
.page.active .anim-row { animation:fadeUp .4s var(--ease) both }
.page.active .anim-row:nth-child(1) { animation-delay:.03s }
.page.active .anim-row:nth-child(2) { animation-delay:.07s }
.page.active .anim-row:nth-child(3) { animation-delay:.11s }
.page.active .anim-row:nth-child(4) { animation-delay:.15s }
.page.active .anim-row:nth-child(5) { animation-delay:.19s }

/* â”€â”€ NAV BAR â”€â”€ */
nav {
  position:fixed;bottom:0;left:50%;transform:translateX(-50%);
  width:100%;max-width:430px;
  height:calc(60px + env(safe-area-inset-bottom,0px));
  padding-bottom:env(safe-area-inset-bottom,0px);
  background:var(--nav-bg);
  backdrop-filter:blur(24px) saturate(180%);
  -webkit-backdrop-filter:blur(24px) saturate(180%);
  border-top:1px solid var(--border);
  display:flex;align-items:center;z-index:200;
}
.nav-btn {
  flex:1;display:flex;flex-direction:column;align-items:center;
  justify-content:center;gap:4px;height:60px;
  background:none;border:none;cursor:pointer;
  color:var(--text3);transition:color .2s var(--ease),transform .15s var(--bounce);
  padding:8px 0 4px;
}
.nav-btn:active { transform:scale(.88) }
.nav-btn.active { color:var(--accent) }
.nav-btn svg { width:22px;height:22px;stroke-width:1.6 }
.nav-btn span { font-size:9.5px;font-weight:600;letter-spacing:.2px }

/* â”€â”€ PAGE HEADER â”€â”€ */
.page-header {
  padding:calc(16px + env(safe-area-inset-top,0px)) 20px 14px;
  display:flex;align-items:flex-end;justify-content:space-between;flex-shrink:0;
  background:var(--header-bg);
  backdrop-filter:blur(20px) saturate(160%);
  -webkit-backdrop-filter:blur(20px) saturate(160%);
  position:sticky;top:0;z-index:10;border-bottom:1px solid var(--border);
}
.page-title { font-size:30px;font-weight:800;letter-spacing:-.8px;color:var(--text);line-height:1 }
.page-title-sub { font-size:12px;font-weight:400;color:var(--text3);margin-top:2px;letter-spacing:.1px }

/* â”€â”€ SECTION LABEL â”€â”€ */
.sec-lbl {
  font-size:12px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;
  color:var(--text3);padding:20px 20px 8px;
}

/* â”€â”€ CARD â”€â”€ */
.card {
  background:var(--card);border-radius:var(--r-lg);
  overflow:hidden;border:1px solid var(--border3);
}
.card-mx  { margin:0 16px }
.card-mb  { margin-bottom:10px }
.card-pad { padding:18px }

/* â”€â”€ DIVIDER â”€â”€ */
.row-div { height:.5px;background:var(--border);margin:0 16px }

/* â”€â”€ INPUT â”€â”€ */
.inp {
  width:100%;background:var(--fill);border:1.5px solid var(--border);border-radius:var(--r-sm);
  padding:13px 16px;color:var(--text);font-size:15px;outline:none;
  font-family:'Figtree','DM Sans',sans-serif;-webkit-appearance:none;
  transition:border-color .18s,background .18s;
}
.inp:focus { border-color:var(--accent);background:var(--fill2) }
.inp::placeholder { color:var(--text4) }
select.inp { cursor:pointer }

/* â”€â”€ BUTTON â”€â”€ */
.btn {
  display:flex;align-items:center;justify-content:center;gap:8px;
  border-radius:var(--r-md);cursor:pointer;
  font-family:'Figtree',sans-serif;font-weight:700;
  transition:opacity .18s,transform .15s var(--bounce);font-size:15px;
  border:none;
}
.btn:active { opacity:.8;transform:scale(.97) }
.btn-primary {
  background:var(--accent);color:#fff;padding:16px 24px;width:100%;
  box-shadow:0 4px 20px var(--accent-glow);
}
.btn-ghost { background:var(--fill2);color:var(--text2);padding:14px 20px;border:1px solid var(--border) }
.btn-danger { background:var(--fill);color:var(--accent);padding:14px 20px;border:1px solid var(--accent-soft) }
.btn-sm { padding:9px 16px;font-size:13px }

/* â”€â”€ TOAST â”€â”€ */
.toast {
  position:fixed;bottom:calc(90px + env(safe-area-inset-bottom,0px));left:50%;
  transform:translateX(-50%) translateY(16px);z-index:9000;
  background:var(--card2);color:var(--text);font-size:13px;font-weight:600;
  padding:12px 22px;border-radius:100px;opacity:0;pointer-events:none;
  box-shadow:var(--shadow-lg);white-space:nowrap;border:1px solid var(--border2);
  transition:opacity .25s,transform .3s var(--spring);
}
.toast.show { opacity:1;transform:translateX(-50%) translateY(0) }

/* â”€â”€ SHEET â”€â”€ */
.sheet-overlay {
  position:fixed;inset:0;
  background:rgba(0,0,0,.55);
  backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);
  z-index:800;opacity:0;pointer-events:none;transition:opacity .28s;
}
.sheet-overlay.show { opacity:1;pointer-events:all }
.sheet {
  position:fixed;bottom:0;left:50%;transform:translateX(-50%) translateY(100%);
  width:100%;max-width:430px;z-index:900;
  background:var(--sheet-bg);border-radius:var(--r-xl) var(--r-xl) 0 0;
  border:1px solid var(--border2);
  padding:0 0 calc(24px + env(safe-area-inset-bottom,0px));
  transition:transform .38s var(--spring);
  max-height:92dvh;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;
}
.sheet::-webkit-scrollbar { display:none }
.sheet.show { transform:translateX(-50%) translateY(0) }
.sheet-handle { width:36px;height:4px;background:var(--border2);border-radius:100px;margin:12px auto 18px }
.sheet-title { font-size:18px;font-weight:800;padding:0 22px 16px;letter-spacing:-.3px;color:var(--text);border-bottom:1px solid var(--border);margin-bottom:12px }
.sheet-sub { font-size:13px;color:var(--text3);padding:8px 22px 12px;line-height:1.6 }

/* â”€â”€ INPUT GROUP â”€â”€ */
.inp-group { padding:8px 22px }
.inp-label { font-size:11px;font-weight:700;color:var(--text3);letter-spacing:.5px;text-transform:uppercase;margin-bottom:8px;display:block }

/* â”€â”€ PILL â”€â”€ */
.pill {
  display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:100px;
  font-size:11px;font-weight:700;letter-spacing:.2px;
}
.pill-accent { background:var(--accent-soft);color:var(--accent) }
.pill-green  { background:rgba(48,209,88,.12);color:var(--green) }
.pill-blue   { background:rgba(10,132,255,.12);color:var(--blue) }

/* â”€â”€ FAB â”€â”€ */
.fab {
  position:fixed;right:20px;bottom:calc(76px + env(safe-area-inset-bottom,0px));
  width:52px;height:52px;
  background:var(--accent);color:#fff;border:none;cursor:pointer;z-index:99;
  border-radius:50%;font-size:24px;display:none;align-items:center;justify-content:center;
  box-shadow:0 4px 24px var(--accent-glow);
  transition:transform .18s var(--bounce),opacity .18s;font-weight:300;
}
.fab:active { transform:scale(.9) }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.hero {
  padding:calc(20px + env(safe-area-inset-top,0px)) 20px 20px;
  flex-shrink:0;position:relative;
  background:linear-gradient(180deg,var(--bg2) 0%,var(--bg) 100%);
}
.hero-date { font-size:12px;color:var(--text3);font-weight:600;letter-spacing:.3px;text-transform:uppercase;margin-bottom:10px }
.hero-greeting { font-size:36px;font-weight:900;line-height:1.05;letter-spacing:-.8px;color:var(--text) }
.hero-greeting em { color:var(--accent);font-style:normal }
.hero-sub { font-size:13px;color:var(--text3);margin-top:8px;line-height:1.6;font-weight:400 }

/* Rings row */
.rings-section { padding:4px 20px 16px }
.rings-row { display:flex;align-items:center;gap:16px;background:var(--card);border-radius:var(--r-lg);padding:20px;border:1px solid var(--border3) }
.ring-wrap { position:relative;flex-shrink:0 }
.ring-wrap svg { transform:rotate(-90deg) }
.ring-center-label { position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center }
.ring-center-num { font-size:18px;font-weight:800;letter-spacing:-.5px;line-height:1 }
.ring-center-sub { font-size:9px;font-weight:600;color:var(--text3);margin-top:1px;text-transform:uppercase;letter-spacing:.4px }
.ring-stats { flex:1;display:flex;flex-direction:column;gap:10px }
.ring-stat { display:flex;align-items:center;gap:10px }
.ring-dot { width:10px;height:10px;border-radius:50%;flex-shrink:0 }
.ring-stat-info { flex:1 }
.ring-stat-lbl { font-size:11px;color:var(--text3);font-weight:500 }
.ring-stat-val { font-size:17px;font-weight:800;letter-spacing:-.4px;line-height:1.1 }
.ring-stat-unit { font-size:11px;color:var(--text3);font-weight:500 }

/* Stats row */
.stats-row { display:flex;gap:10px;padding:0 16px }
.stat-tile {
  flex:1;background:var(--card);border-radius:var(--r-md);padding:16px 14px;
  border:1px solid var(--border3);cursor:pointer;transition:transform .15s var(--bounce);
}
.stat-tile:active { transform:scale(.96) }
.stat-tile-icon { font-size:20px;margin-bottom:8px }
.stat-tile-val { font-size:22px;font-weight:800;letter-spacing:-.6px;line-height:1 }
.stat-tile-val em { font-size:12px;font-weight:500;color:var(--text3);font-style:normal;margin-left:1px }
.stat-tile-lbl { font-size:11px;color:var(--text3);font-weight:500;margin-top:3px }

/* Streak card */
.streak-card { margin:0 16px;background:var(--card);border-radius:var(--r-lg);padding:18px;border:1px solid var(--border3);display:flex;align-items:center;gap:16px }
.streak-num { font-size:52px;font-weight:900;line-height:1;color:var(--accent);letter-spacing:-2px }
.streak-right { flex:1 }
.streak-title { font-size:15px;font-weight:700 }
.streak-sub { font-size:12px;color:var(--text3);margin-top:2px }
.streak-dots { display:flex;gap:5px;margin-top:10px;flex-wrap:wrap }
.streak-dot { width:26px;height:5px;background:var(--fill2);border-radius:100px }
.streak-dot.on { background:var(--accent) }

/* Gym card */
.gym-card { margin:0 16px;background:var(--card);border-radius:var(--r-lg);border:1px solid var(--border3);overflow:hidden }
.gym-top { padding:16px 18px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border) }
.gym-label { font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px }
.gym-time-big { font-size:28px;font-weight:900;letter-spacing:-.8px;color:var(--accent);line-height:1 }
.gym-set-btn { background:var(--accent);color:#fff;border:none;padding:10px 18px;font-size:13px;font-weight:700;cursor:pointer;border-radius:var(--r-sm);letter-spacing:.1px;transition:transform .15s var(--bounce) }
.gym-set-btn:active { transform:scale(.93) }
.gym-bottom { display:flex }
.gym-bottom-item { flex:1;padding:12px 18px;border-right:1px solid var(--border) }
.gym-bottom-item:last-child { border-right:none }
.gym-bottom-lbl { font-size:10px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.4px }
.gym-bottom-val { font-size:14px;font-weight:700;margin-top:2px }

/* Water card */
.water-card { margin:0 16px;background:var(--card);border-radius:var(--r-lg);padding:18px;border:1px solid var(--border3) }
.water-top { display:flex;align-items:center;justify-content:space-between;margin-bottom:14px }
.water-lbl { font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px }
.water-val { font-size:22px;font-weight:800;letter-spacing:-.5px }
.water-cups-row { display:flex;gap:5px }
.wcup { flex:1;height:36px;border-radius:var(--r-sm);border:1.5px solid var(--border2);cursor:pointer;position:relative;overflow:hidden;transition:all .2s var(--bounce) }
.wcup.filled { border-color:var(--blue);background:rgba(10,132,255,.15) }
.wcup:active { transform:scale(.87) }

/* Quote card */
.quote-card { margin:0 16px;background:var(--card);border-radius:var(--r-lg);padding:18px;border:1px solid var(--border3) }
.quote-text { font-size:13px;line-height:1.7;color:var(--text2);font-weight:400;font-style:italic }
.quote-bar { width:28px;height:3px;background:var(--accent);border-radius:100px;margin-bottom:10px }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORKOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.day-scroll { display:flex;gap:8px;padding:14px 16px;overflow-x:auto;scrollbar-width:none;flex-shrink:0;border-bottom:1px solid var(--border) }
.day-scroll::-webkit-scrollbar { display:none }
.day-chip {
  display:flex;flex-direction:column;align-items:center;min-width:50px;
  padding:10px 6px;border:1.5px solid var(--border);border-radius:var(--r-sm);
  cursor:pointer;transition:all .2s var(--ease);flex-shrink:0;
  background:transparent;
}
.day-chip.selected { background:var(--accent);border-color:var(--accent);color:#fff }
.day-chip.selected .day-name { color:#fff }
.day-chip.selected .day-num { color:#fff }
.day-name { font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.3px }
.day-num  { font-size:15px;font-weight:800;color:var(--text);margin-top:3px }
.day-dot  { width:5px;height:5px;border-radius:50%;background:var(--green);margin-top:5px;opacity:0 }
.day-dot.done { opacity:1 }

.workout-header { padding:18px 16px 12px }
.wk-session-tag { display:inline-flex;align-items:center;gap:6px;margin-bottom:8px }
.wk-title { font-size:22px;font-weight:800;letter-spacing:-.5px }
.wk-meta  { font-size:13px;color:var(--text3);font-weight:400;margin-top:3px }

.start-btn-wrap { padding:0 16px 8px }
.sesh-prog-row { display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--card);border-bottom:1px solid var(--border) }
.sesh-prog-lbl { font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.4px;width:60px }
.sesh-prog-val { font-size:12px;font-weight:700;color:var(--text3);width:30px;text-align:right }
.prog-track { height:5px;background:var(--fill2);border-radius:100px;overflow:hidden;flex:1 }
.prog-fill  { height:100%;background:var(--accent);border-radius:100px;transition:width .4s var(--ease) }

/* Exercise list */
.ex-list { display:flex;flex-direction:column;gap:10px;padding:10px 16px }
.ex-card {
  background:var(--card);border-radius:var(--r-lg);padding:16px;
  border:1px solid var(--border3);transition:border-color .2s;
}
.ex-card.done { border-color:rgba(48,209,88,.3);background:rgba(48,209,88,.04) }
.ex-card.done .ex-name { color:var(--text3) }
.ex-top { display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:6px }
.ex-num { font-size:10px;font-weight:700;color:var(--text4);text-transform:uppercase;letter-spacing:.5px;margin-bottom:2px }
.ex-name { font-size:15px;font-weight:700;letter-spacing:-.2px;line-height:1.2 }
.ex-eq { font-size:11px;color:var(--accent);font-weight:600;margin-top:2px }
.ex-plan { font-size:12px;color:var(--text3);margin-top:4px }
.ex-pr { font-size:13px;font-weight:800;color:var(--accent);background:var(--accent-soft);padding:4px 10px;border-radius:100px }
.ex-tip { font-size:12px;color:var(--text3);font-style:italic;margin-top:8px;padding-top:8px;border-top:1px solid var(--border);line-height:1.5 }
.ex-done-check { width:28px;height:28px;border-radius:50%;background:var(--fill2);border:2px solid var(--border2);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;transition:all .2s var(--bounce) }
.ex-done-check.checked { background:var(--green);border-color:var(--green) }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALORIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cal-hero { padding:24px 20px 16px;text-align:center }
.cal-ring-section { display:flex;justify-content:center;padding:8px 0 20px;position:relative }
.cal-ring-container { position:relative;width:200px;height:200px }
.cal-ring-container svg { transform:rotate(-90deg) }
.cal-ring-center { position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center }
.cal-ring-num { font-size:36px;font-weight:900;letter-spacing:-1.5px;line-height:1 }
.cal-ring-label { font-size:11px;color:var(--text3);font-weight:600;margin-top:4px;text-transform:uppercase;letter-spacing:.5px }

.cal-stats-row { display:flex;background:var(--card);border-radius:var(--r-lg);border:1px solid var(--border3);margin:0 16px;overflow:hidden }
.cal-stat-item { flex:1;padding:16px 8px;text-align:center;border-right:1px solid var(--border) }
.cal-stat-item:last-child { border-right:none }
.cal-stat-val { font-size:20px;font-weight:800;letter-spacing:-.5px }
.cal-stat-lbl { font-size:10px;font-weight:600;color:var(--text3);margin-top:2px;text-transform:uppercase;letter-spacing:.3px }

/* Macro bars */
.macro-bars { background:var(--card);border-radius:var(--r-lg);border:1px solid var(--border3);overflow:hidden }
.macro-row { display:flex;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid var(--border) }
.macro-row:last-child { border-bottom:none }
.macro-lbl { font-size:13px;font-weight:700;width:60px }
.macro-val { font-size:12px;font-weight:600;color:var(--text3);width:80px;text-align:right }
.macro-val span { color:var(--text);font-weight:800 }

/* TDEE breakdown */
.tdee-breakdown-card { background:var(--card);border-radius:var(--r-lg);border:1px solid var(--border3);overflow:hidden }
.tdee-bd-row { display:flex;align-items:center;gap:14px;padding:14px 18px;border-bottom:1px solid var(--border) }
.tdee-bd-row:last-child { border-bottom:none }
.tdee-bd-icon { font-size:22px;width:32px;text-align:center }
.tdee-bd-info { flex:1 }
.tdee-bd-label { font-size:14px;font-weight:600 }
.tdee-bd-sub { font-size:11px;color:var(--text3);margin-top:1px }
.tdee-bd-val { font-size:16px;font-weight:800;letter-spacing:-.3px }

/* Quick food grid */
.qfood-grid { display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 16px }
.qfood-card {
  background:var(--card);border-radius:var(--r-md);padding:14px;
  border:1px solid var(--border3);cursor:pointer;
  display:flex;flex-direction:column;gap:4px;
  transition:transform .15s var(--bounce),border-color .18s;
}
.qfood-card:active { transform:scale(.95);border-color:var(--accent) }
.qfood-icon { font-size:24px;margin-bottom:4px }
.qfood-name { font-size:12px;font-weight:700;line-height:1.2 }
.qfood-kcal { font-size:13px;font-weight:800;color:var(--accent) }
.qfood-macros { font-size:10px;color:var(--text3);font-weight:500 }

/* Food log */
.food-log-list { display:flex;flex-direction:column;gap:6px;padding:0 16px }
.food-log-item { background:var(--card);border-radius:var(--r-md);padding:14px 16px;border:1px solid var(--border3);display:flex;align-items:center;gap:12px }
.food-log-info { flex:1;min-width:0 }
.food-log-name { font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis }
.food-log-macros { font-size:11px;color:var(--text3);margin-top:2px }
.food-log-kcal { font-size:18px;font-weight:800;color:var(--accent);flex-shrink:0 }
.food-log-del { width:28px;height:28px;background:var(--fill2);border:none;border-radius:50%;cursor:pointer;color:var(--text3);font-size:14px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .15s }
.food-log-del:active { background:var(--accent-soft);color:var(--accent) }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REPORTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.report-tabs { display:flex;gap:6px;background:var(--fill);border-radius:var(--r-sm);padding:4px }
.r-tab { flex:1;background:none;border:none;cursor:pointer;font-size:13px;font-weight:600;color:var(--text3);padding:8px;border-radius:calc(var(--r-sm) - 4px);transition:all .2s var(--ease);font-family:'Figtree',sans-serif }
.r-tab.active { background:var(--card2);color:var(--text);box-shadow:var(--shadow-sm) }

.chart-card { background:var(--card);border-radius:var(--r-lg);padding:18px;border:1px solid var(--border3) }
.chart-title { font-size:16px;font-weight:800;letter-spacing:-.3px;margin-bottom:2px }
.chart-sub   { font-size:12px;color:var(--text3);margin-bottom:14px }
.chart-svg   { width:100%;overflow:visible }

.deficit-card { background:var(--card);border-radius:var(--r-lg);padding:18px;border:1px solid var(--border3) }
.deficit-title { font-size:12px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px }
.deficit-num { font-size:42px;font-weight:900;letter-spacing:-2px;line-height:1 }
.deficit-num em { font-size:18px;color:var(--text3);font-style:normal;font-weight:600 }
.deficit-breakdown { display:flex;gap:0;border-top:1px solid var(--border);margin-top:14px }
.deficit-item { flex:1;padding:12px 0;text-align:center;border-right:1px solid var(--border) }
.deficit-item:last-child { border-right:none }
.deficit-item-val { font-size:17px;font-weight:800;letter-spacing:-.4px }
.deficit-item-lbl { font-size:10px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.3px;margin-top:2px }

.report-kpi-grid { display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 16px }
.kpi-card { background:var(--card);border-radius:var(--r-lg);padding:16px;border:1px solid var(--border3) }
.kpi-label { font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.4px;margin-bottom:6px }
.kpi-val { font-size:22px;font-weight:900;letter-spacing:-.5px }
.kpi-delta { font-size:11px;font-weight:600;margin-top:3px }
.kpi-delta.pos { color:var(--green) }
.kpi-delta.neg { color:var(--accent) }

.ex-prog-list { display:flex;flex-direction:column;gap:8px;padding:0 16px }
.ex-prog-card { background:var(--card);border-radius:var(--r-md);padding:14px 16px;border:1px solid var(--border3) }
.ex-prog-name { font-size:13px;font-weight:700;margin-bottom:8px }
.ex-prog-row { display:flex;align-items:center;gap:10px }
.ex-prog-num { font-size:18px;font-weight:800;color:var(--accent);letter-spacing:-.5px;width:60px }
.ex-prog-lbl { font-size:11px;color:var(--text3);font-weight:500 }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.body-metrics-grid { display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:0 16px }
.body-metric-card { background:var(--card);border-radius:var(--r-lg);padding:16px;border:1px solid var(--border3) }
.bm-icon { font-size:22px;margin-bottom:8px }
.bm-val { font-size:24px;font-weight:900;letter-spacing:-.6px }
.bm-unit { font-size:12px;color:var(--text3);font-weight:500 }
.bm-lbl { font-size:11px;color:var(--text3);font-weight:600;margin-top:4px;text-transform:uppercase;letter-spacing:.3px }
.bm-sub { font-size:11px;color:var(--text3);margin-top:2px }

.settings-list { display:flex;flex-direction:column;padding:0 16px;gap:8px }
.setting-row {
  display:flex;align-items:center;gap:14px;padding:16px;cursor:pointer;
  background:var(--card);border-radius:var(--r-md);border:1px solid var(--border3);
  transition:transform .15s var(--bounce);
}
.setting-row:active { transform:scale(.98) }
.setting-icon { font-size:22px;width:34px;text-align:center }
.setting-info { flex:1;min-width:0 }
.setting-title { font-size:15px;font-weight:600;letter-spacing:-.1px }
.setting-sub { font-size:12px;color:var(--text3);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis }
.setting-right { color:var(--text3);flex-shrink:0 }

/* Toggle */
.toggle-sw { position:relative;display:inline-block;width:50px;height:30px;flex-shrink:0 }
.toggle-sw input { opacity:0;width:0;height:0 }
.toggle-track {
  position:absolute;inset:0;cursor:pointer;
  background:var(--fill2);border-radius:100px;border:1.5px solid var(--border2);
  transition:background .2s;
}
.toggle-track::before {
  content:'';position:absolute;left:3px;bottom:3px;
  width:22px;height:22px;border-radius:50%;
  background:#fff;transition:transform .25s var(--spring);
  box-shadow:0 2px 6px rgba(0,0,0,.3);
}
.toggle-sw input:checked + .toggle-track { background:var(--accent);border-color:var(--accent) }
.toggle-sw input:checked + .toggle-track::before { transform:translateX(20px) }

/* Progress bars */
.progress-section { padding:0 16px }
.progress-card { background:var(--card);border-radius:var(--r-lg);padding:18px;border:1px solid var(--border3);margin-bottom:10px }
.progress-label-row { display:flex;justify-content:space-between;margin-bottom:10px }
.progress-label { font-size:14px;font-weight:700 }
.progress-range { font-size:12px;color:var(--text3);font-weight:500 }
.progress-bar { height:8px;background:var(--fill2);border-radius:100px;overflow:hidden }
.progress-fill { height:100%;background:var(--accent);border-radius:100px;transition:width .5s var(--ease) }
.progress-fill.green { background:var(--green) }

/* Phase card */
.phase-card { background:var(--card);border-radius:var(--r-lg);border:1px solid var(--border3);overflow:hidden;margin:0 16px }
.phase-card-hdr { padding:18px;background:linear-gradient(135deg,rgba(255,107,107,.08) 0%,transparent 100%);border-bottom:1px solid var(--border) }
.phase-card-title { font-size:18px;font-weight:800;letter-spacing:-.4px }
.phase-card-sub { font-size:12px;color:var(--text3);margin-top:4px;line-height:1.5 }
.phase-targets-grid { display:grid;grid-template-columns:1fr 1fr }
.phase-target-item { padding:14px 18px;border-right:1px solid var(--border);border-bottom:1px solid var(--border) }
.phase-target-item:nth-child(even) { border-right:none }
.phase-target-item:nth-last-child(-n+2) { border-bottom:none }
.phase-target-item-val { font-size:16px;font-weight:800;letter-spacing:-.3px;margin-bottom:3px }
.phase-target-item-lbl { font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.4px }

/* Milestones */
.milestone-card { background:var(--card);border-radius:var(--r-md);padding:16px;border:1px solid var(--border3) }
.milestone-card.current-phase { border-color:var(--accent);background:var(--accent-soft) }
.milestone-card.achieved { border-color:rgba(48,209,88,.3);background:rgba(48,209,88,.04) }
.milestone-period { font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px }
.milestone-title { font-size:15px;font-weight:800;letter-spacing:-.3px }
.milestone-badge { display:inline-flex;align-items:center;gap:4px;font-size:10px;font-weight:700;padding:3px 9px;border-radius:100px;margin-bottom:6px;letter-spacing:.2px }
.milestone-badge.current { background:var(--accent-soft);color:var(--accent) }
.milestone-badge.achieved { background:rgba(48,209,88,.15);color:var(--green) }
.milestone-badge.future { background:var(--fill2);color:var(--text3) }

/* Pushup tracker */
.pushup-card { margin:0 16px;background:var(--card);border-radius:var(--r-lg);padding:18px;border:1px solid var(--border3);display:flex;align-items:center;gap:16px }
.pushup-val { font-size:48px;font-weight:900;color:var(--accent);letter-spacing:-2px;line-height:1 }
.pushup-controls { display:flex;flex-direction:column;gap:6px }
.pu-btn { width:36px;height:36px;background:var(--fill2);border:1.5px solid var(--border2);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s var(--bounce);color:var(--text2) }
.pu-btn:active { transform:scale(.88);background:var(--accent);color:#fff;border-color:var(--accent) }

/* Roadmap */
.roadmap-card { margin:0 16px;background:var(--card);border-radius:var(--r-lg);border:1px solid var(--border3);overflow:hidden }
.roadmap-row { display:flex;align-items:flex-start;gap:12px;padding:14px 18px;border-bottom:1px solid var(--border) }
.roadmap-row:last-child { border-bottom:none }
.roadmap-row.current { background:var(--accent-soft) }

/* Phase option sheet cards */
.phase-option-card { background:var(--card);border-radius:var(--r-md);padding:16px;border:2px solid var(--border);cursor:pointer;transition:all .2s var(--ease) }
.phase-option-card.selected { border-color:var(--accent);background:var(--accent-soft) }
.phase-option-year { font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px }
.phase-option-name { font-size:15px;font-weight:800;letter-spacing:-.2px }
.phase-option-months { font-size:12px;color:var(--text3);margin-top:4px;line-height:1.5 }

/* Phase up banner */
#phase-up-banner { margin:0 16px 10px;background:var(--accent-soft);border:1.5px solid var(--accent-glow);border-radius:var(--r-lg);padding:16px }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIVE SESSION OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#active-session {
  display:none;position:fixed;inset:0;left:50%;transform:translateX(-50%);max-width:430px;
  background:var(--bg);z-index:500;
  flex-direction:column;overflow:hidden;
  animation:slideUp .35s var(--spring);
}
#active-session.visible { display:flex }
.as-header { display:flex;align-items:center;gap:12px;padding:calc(16px + env(safe-area-inset-top,0px)) 16px 14px;border-bottom:1px solid var(--border);flex-shrink:0 }
.as-close { width:36px;height:36px;background:var(--fill2);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0;border:1px solid var(--border2) }
.as-title-wrap { flex:1 }
.as-session-name { font-size:16px;font-weight:800;letter-spacing:-.3px }
.as-ex-count { font-size:12px;color:var(--text3);margin-top:2px }
.as-timer-wrap { text-align:right }
.as-timer { font-size:22px;font-weight:800;letter-spacing:-.5px;color:var(--accent) }
.as-live-burn { font-size:11px;color:var(--text3);font-weight:600 }
.as-progress-row { display:flex;align-items:center;gap:10px;padding:12px 16px;background:var(--card);border-bottom:1px solid var(--border);flex-shrink:0 }
.as-prog-val { font-size:12px;font-weight:700;color:var(--text3);width:36px;text-align:right }
.as-body { flex:1;overflow-y:auto;scrollbar-width:none;padding:16px }
.as-body::-webkit-scrollbar { display:none }
.as-ex-num { font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px }
.as-ex-name { font-size:24px;font-weight:900;letter-spacing:-.5px;margin-bottom:4px }
.as-ex-plan { font-size:14px;color:var(--text2);margin-bottom:6px }
.as-ex-eq { color:var(--accent);font-size:13px;font-weight:600;margin-bottom:16px }
.as-weight-row { display:flex;align-items:center;gap:16px;margin-bottom:16px }
.as-w-btn { width:48px;height:48px;background:var(--fill2);border:1.5px solid var(--border2);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:22px;color:var(--text2);transition:all .15s var(--bounce) }
.as-w-btn:active { transform:scale(.88);background:var(--accent-soft);border-color:var(--accent) }
.as-w-val { flex:1;text-align:center;font-size:36px;font-weight:900;letter-spacing:-1.5px;color:var(--text) }
.as-w-unit { font-size:14px;color:var(--text3);font-weight:500 }
.as-sets-grid { display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:16px }
.as-set-btn { height:52px;background:var(--fill);border:1.5px solid var(--border2);border-radius:var(--r-sm);cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;transition:all .15s var(--bounce) }
.as-set-btn.done { background:rgba(48,209,88,.12);border-color:var(--green) }
.as-set-btn:active { transform:scale(.9) }
.as-set-label { font-size:9px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px }
.as-set-val { font-size:14px;font-weight:800;color:var(--text) }
.as-set-btn.done .as-set-val { color:var(--green) }
.as-tip-box { background:var(--card);border-radius:var(--r-md);padding:14px;border:1px solid var(--border3) }
.as-tip-lbl { font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px }
.as-tip-text { font-size:13px;color:var(--text2);line-height:1.6;font-style:italic }
.as-footer { display:flex;gap:8px;padding:14px 16px;border-top:1px solid var(--border);flex-shrink:0;padding-bottom:calc(14px + env(safe-area-inset-bottom,0px)) }

/* Rest overlay */
.rest-overlay {
  display:none;position:fixed;inset:0;left:50%;transform:translateX(-50%);max-width:430px;
  z-index:600;background:rgba(0,0,0,.92);
  backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
  flex-direction:column;align-items:center;justify-content:center;gap:12px;
}
.rest-overlay.show { display:flex }
.rest-title { font-size:13px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.8px }
.rest-big { font-size:80px;font-weight:900;letter-spacing:-4px;color:var(--accent);line-height:1;animation:pulse 1s ease-in-out infinite }
.rest-next { font-size:14px;color:var(--text2);font-weight:500 }
.rest-skip { background:var(--fill2);border:1.5px solid var(--border2);color:var(--text2);padding:12px 28px;border-radius:100px;font-size:14px;font-weight:700;cursor:pointer;margin-top:16px;transition:all .15s }
.rest-skip:active { background:var(--accent);border-color:var(--accent);color:#fff }

/* Session complete */
.session-complete {
  display:none;position:fixed;inset:0;left:50%;transform:translateX(-50%);max-width:430px;
  z-index:700;background:var(--bg);
  flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:40px 28px;
}
.session-complete.show { display:flex }
.sc-icon { font-size:72px;margin-bottom:8px;animation:scaleIn .4s var(--bounce) }
.sc-title { font-size:42px;font-weight:900;text-align:center;letter-spacing:-.8px;line-height:1.1 }
.sc-subtitle { font-size:15px;color:var(--text3);text-align:center;font-weight:400 }
.sc-stats { background:var(--card);border-radius:var(--r-lg);padding:18px;width:100%;border:1px solid var(--border3);margin:10px 0 }

/* Notif */
.notif-alert { margin:10px 16px 0;background:var(--accent-soft);border:1.5px solid var(--accent-glow);border-radius:var(--r-md);padding:14px;display:flex;align-items:center;gap:12px }
.notif-icon { font-size:24px;flex-shrink:0 }
.notif-title { font-size:13px;font-weight:700;color:var(--accent) }
.notif-sub { font-size:12px;color:var(--text3);margin-top:2px }

/* Burn sheet */
.burn-sheet-big { font-size:52px;font-weight:900;letter-spacing:-2px;color:var(--accent);line-height:1 }

/* Weight suggest sheet */
.wss-row { display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--border);background:var(--card);margin:0 22px 0;border-radius:var(--r-sm) }

</style>
</head>
<body>
<div id="app">

<!-- â•â•â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â•â•â• -->
<div class="page active" id="page-home">
  <div class="hero anim-row">
    <div class="hero-date" id="hero-date">SUNDAY, 22 FEBRUARY</div>
    <div class="hero-greeting">Good Morning,<br><em id="hero-word">Rise.</em></div>
    <div class="hero-sub" id="hero-sub">One day closer. Keep the streak alive.</div>
  </div>

  <!-- Calorie ring + stats -->
  <div class="rings-section anim-row">
    <div class="rings-row">
      <div class="ring-wrap">
        <svg width="130" height="130" viewBox="0 0 130 130">
          <circle cx="65" cy="65" r="54" fill="none" stroke="var(--fill2)" stroke-width="10"/>
          <circle id="ring-arc" cx="65" cy="65" r="54" fill="none" stroke="var(--accent)" stroke-width="10" stroke-linecap="round" stroke-dasharray="339" stroke-dashoffset="339" style="transition:stroke-dashoffset .8s var(--ease)"/>
          <circle cx="65" cy="65" r="38" fill="none" stroke="var(--fill2)" stroke-width="7"/>
          <circle id="ring-bmr" cx="65" cy="65" r="38" fill="none" stroke="var(--blue)" stroke-width="7" stroke-linecap="round" stroke-dasharray="239" stroke-dashoffset="239" style="transition:stroke-dashoffset .8s var(--ease)"/>
        </svg>
        <div class="ring-center-label">
          <div class="ring-center-num" id="ring-remain-home">â€”</div>
          <div class="ring-center-sub">left</div>
        </div>
      </div>
      <div class="ring-stats">
        <div class="ring-stat">
          <div class="ring-dot" style="background:var(--accent)"></div>
          <div class="ring-stat-info">
            <div class="ring-stat-lbl">Eaten</div>
            <div class="ring-stat-val" id="h-cal">0 <span class="ring-stat-unit">kcal</span></div>
          </div>
        </div>
        <div class="ring-stat">
          <div class="ring-dot" style="background:var(--blue)"></div>
          <div class="ring-stat-info">
            <div class="ring-stat-lbl">Burned</div>
            <div class="ring-stat-val" id="tdee-net-home">0 <span class="ring-stat-unit">kcal</span></div>
          </div>
        </div>
        <div class="ring-stat">
          <div class="ring-dot" style="background:var(--green)"></div>
          <div class="ring-stat-info">
            <div class="ring-stat-lbl">Weight</div>
            <div class="ring-stat-val" id="h-weight">â€” <span class="ring-stat-unit">kg</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Streak + streak dots -->
  <div class="sec-lbl">Streak</div>
  <div class="streak-card anim-row">
    <div class="streak-num" id="streak-big">0</div>
    <div class="streak-right">
      <div class="streak-title">Day Streak</div>
      <div class="streak-sub" id="h-streak-sub">Keep showing up</div>
      <div class="streak-dots" id="streak-dots"></div>
    </div>
  </div>

  <!-- Gym time -->
  <div class="sec-lbl">Today's Session</div>
  <div class="gym-card anim-row">
    <div class="gym-top">
      <div>
        <div class="gym-label">Gym Time</div>
        <div class="gym-time-big" id="gym-time-display">Set Time</div>
      </div>
      <button class="gym-set-btn" id="gym-set-btn">Edit</button>
    </div>
    <div class="gym-bottom">
      <div class="gym-bottom-item">
        <div class="gym-bottom-lbl">Countdown</div>
        <div class="gym-bottom-val" id="gym-countdown">â€”</div>
      </div>
      <div class="gym-bottom-item">
        <div class="gym-bottom-lbl">Pre-Workout</div>
        <div class="gym-bottom-val" id="preworkout-info">â€”</div>
      </div>
    </div>
  </div>

  <!-- Notif -->
  <div id="home-notif" class="notif-alert" style="display:none">
    <div class="notif-icon">ğŸ’§</div>
    <div><div class="notif-title" id="notif-title">Reminder</div><div class="notif-sub" id="notif-sub"></div></div>
  </div>

  <!-- Water -->
  <div class="sec-lbl">Hydration</div>
  <div class="water-card anim-row">
    <div class="water-top">
      <div>
        <div class="water-lbl">Water Today</div>
        <div class="water-val" id="water-ml">0.0L</div>
      </div>
      <span class="pill pill-blue">Target: 3.5L</span>
    </div>
    <div class="water-cups-row" id="water-cups"></div>
  </div>

  <!-- Quote -->
  <div class="sec-lbl">Today's Reminder</div>
  <div class="quote-card anim-row">
    <div class="quote-bar"></div>
    <div class="quote-text" id="hero-quote2">"72 kg. 6K in 25 min. Lean V-taper. It's already decided."</div>
  </div>
  <div style="height:8px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• WORKOUT â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-workout">
  <div class="page-header">
    <div>
      <div class="page-title">Workout</div>
      <div class="page-title-sub" id="workout-date-sub">Today's Training</div>
    </div>
  </div>
  <div class="day-scroll" id="day-scroll"></div>
  <div class="workout-header">
    <div class="wk-session-tag">
      <span class="pill pill-accent" id="wk-day-tag">Day 1</span>
    </div>
    <div class="wk-title" id="wk-title">Upper Strength</div>
    <div class="wk-meta" id="wk-meta">Chest + Back Â· ~55 min</div>
  </div>
  <div class="start-btn-wrap">
    <button class="btn btn-primary" id="start-session-btn">Start Session</button>
  </div>
  <div style="display:flex;align-items:center;gap:10px;padding:10px 16px;background:var(--card);border-bottom:1px solid var(--border)">
    <div class="sesh-prog-lbl">Progress</div>
    <div class="prog-track" style="flex:1"><div class="prog-fill" id="sesh-prog-bar" style="width:0%"></div></div>
    <div class="sesh-prog-val" id="sesh-prog-val">0/0</div>
  </div>
  <div class="ex-list" id="ex-list"></div>
  <div style="height:12px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• CALORIES â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-cal">
  <div class="page-header">
    <div>
      <div class="page-title">Nutrition</div>
      <div class="page-title-sub" id="cal-date-lbl">Today</div>
    </div>
    <span class="pill pill-accent" id="cal-day-type">Veg Day</span>
  </div>

  <div class="cal-ring-section">
    <div class="cal-ring-container">
      <svg width="200" height="200" viewBox="0 0 200 200">
        <circle cx="100" cy="100" r="82" fill="none" stroke="var(--fill2)" stroke-width="13"/>
        <circle id="ring-arc2" cx="100" cy="100" r="82" fill="none" stroke="var(--accent)" stroke-width="13" stroke-linecap="round" stroke-dasharray="515" stroke-dashoffset="515" style="transition:stroke-dashoffset .8s var(--ease)"/>
        <circle cx="100" cy="100" r="60" fill="none" stroke="var(--fill2)" stroke-width="9"/>
        <circle id="ring-protein" cx="100" cy="100" r="60" fill="none" stroke="var(--green)" stroke-width="9" stroke-linecap="round" stroke-dasharray="377" stroke-dashoffset="377" style="transition:stroke-dashoffset .8s var(--ease)"/>
      </svg>
      <div class="cal-ring-center">
        <div class="cal-ring-num" id="cal-remain">â€”</div>
        <div class="cal-ring-label">remaining</div>
      </div>
    </div>
  </div>

  <div class="cal-stats-row card-mb">
    <div class="cal-stat-item"><div class="cal-stat-val" id="cal-eaten">0</div><div class="cal-stat-lbl">Eaten</div></div>
    <div class="cal-stat-item"><div class="cal-stat-val" id="cal-burned-txt" style="color:var(--accent)">0</div><div class="cal-stat-lbl">Burned</div></div>
    <div class="cal-stat-item"><div class="cal-stat-val" id="ring-pct">0%</div><div class="cal-stat-lbl">of Goal</div></div>
  </div>

  <div class="sec-lbl">Macros</div>
  <div class="macro-bars card-mx card-mb">
    <div class="macro-row">
      <div class="macro-lbl">Protein</div>
      <div style="flex:1" class="prog-track"><div class="prog-fill" id="bar-p" style="width:0%;background:var(--green)"></div></div>
      <div class="macro-val"><span id="val-p">0</span>/<span id="tgt-p">110</span>g</div>
    </div>
    <div class="macro-row">
      <div class="macro-lbl">Carbs</div>
      <div style="flex:1" class="prog-track"><div class="prog-fill" id="bar-c" style="width:0%;background:var(--blue)"></div></div>
      <div class="macro-val"><span id="val-c">0</span>/<span id="tgt-c">303</span>g</div>
    </div>
    <div class="macro-row">
      <div class="macro-lbl">Fat</div>
      <div style="flex:1" class="prog-track"><div class="prog-fill" id="bar-f" style="width:0%;background:var(--amber)"></div></div>
      <div class="macro-val"><span id="val-f">0</span>/<span id="tgt-f">61</span>g</div>
    </div>
  </div>

  <div class="sec-lbl">Energy Balance</div>
  <div class="tdee-breakdown-card card-mx card-mb">
    <div class="tdee-bd-row"><div class="tdee-bd-icon">ğŸ¯</div><div class="tdee-bd-info"><div class="tdee-bd-label">Daily Target</div><div class="tdee-bd-sub">Your calorie goal</div></div><div class="tdee-bd-val" id="tdb-target">â€”</div></div>
    <div class="tdee-bd-row"><div class="tdee-bd-icon">ğŸ§ </div><div class="tdee-bd-info"><div class="tdee-bd-label">BMR</div><div class="tdee-bd-sub">Resting metabolic burn</div></div><div class="tdee-bd-val" id="tdb-bmr">â€”</div></div>
    <div class="tdee-bd-row"><div class="tdee-bd-icon">ğŸš¶</div><div class="tdee-bd-info"><div class="tdee-bd-label">NEAT</div><div class="tdee-bd-sub">Daily activity burn</div></div><div class="tdee-bd-val" id="tdb-neat">~150</div></div>
    <div class="tdee-bd-row"><div class="tdee-bd-icon">ğŸ‹ï¸</div><div class="tdee-bd-info"><div class="tdee-bd-label">Workout</div><div class="tdee-bd-sub">Today's session</div></div><div class="tdee-bd-val" id="tdb-workout" style="color:var(--accent)">0</div></div>
    <div class="tdee-bd-row" style="border-top:1px solid var(--border2)"><div class="tdee-bd-icon">âš¡</div><div class="tdee-bd-info"><div class="tdee-bd-label" style="font-weight:800">Total TDEE</div><div class="tdee-bd-sub">All burns combined</div></div><div class="tdee-bd-val" id="tdb-total" style="font-size:18px;font-weight:900">â€”</div></div>
  </div>

  <div class="sec-lbl">Quick Add</div>
  <div class="qfood-grid" id="qfood-grid"></div>

  <div class="sec-lbl">Today's Log</div>
  <div class="food-log-list" id="food-log-list">
    <div style="color:var(--text3);font-size:13px;text-align:center;padding:28px;background:var(--card);border-radius:var(--r-lg);border:1px solid var(--border3)">No food logged yet</div>
  </div>
  <div style="height:16px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• REPORTS â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-reports">
  <div class="page-header"><div class="page-title">Reports</div></div>
  <div style="padding:14px 16px 0">
    <div class="report-tabs" id="report-tabs">
      <button class="r-tab active" data-period="week">Week</button>
      <button class="r-tab" data-period="month">Month</button>
      <button class="r-tab" data-period="quarter">Quarter</button>
      <button class="r-tab" data-period="year">Year</button>
    </div>
  </div>
  <div class="sec-lbl">Net Deficit</div>
  <div class="deficit-card card-mx">
    <div class="deficit-title">Calorie Deficit</div>
    <div class="deficit-num"><span id="deficit-num">0</span><em> kcal</em></div>
    <div style="font-size:12px;color:var(--text3);margin-top:8px;font-weight:400" id="deficit-sub">Deficit = fat loss. Keep going.</div>
    <div class="deficit-breakdown">
      <div class="deficit-item"><div class="deficit-item-val" id="r-consumed">0</div><div class="deficit-item-lbl">Consumed</div></div>
      <div class="deficit-item"><div class="deficit-item-val" id="r-burned">0</div><div class="deficit-item-lbl">Burned</div></div>
      <div class="deficit-item"><div class="deficit-item-val" id="r-bmr">0</div><div class="deficit-item-lbl">BMR Total</div></div>
    </div>
  </div>
  <div class="sec-lbl">Key Metrics</div>
  <div class="report-kpi-grid" id="report-kpis"></div>
  <div class="sec-lbl">Weight Trend</div>
  <div class="chart-card card-mx">
    <div class="chart-title" id="weight-chart-title">Weight</div>
    <div class="chart-sub">Progress over period</div>
    <svg class="chart-svg" id="weight-chart" viewBox="0 0 340 180" width="100%" height="180" preserveAspectRatio="none"></svg>
  </div>
  <div class="sec-lbl">Strength Progress</div>
  <div class="ex-prog-list" id="ex-prog-list"></div>
  <div class="sec-lbl">Body Trends</div>
  <div class="chart-card card-mx">
    <div class="chart-title">Waist & Resting HR</div>
    <div class="chart-sub">Measurements over time</div>
    <svg class="chart-svg" id="body-chart" viewBox="0 0 340 160" width="100%" height="160" preserveAspectRatio="none"></svg>
  </div>
  <div style="height:16px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• PROFILE â•â•â•â•â•â•â•â•â•â• -->
<div class="page" id="page-profile">
  <div class="page-header"><div class="page-title">Profile</div></div>

  <div class="sec-lbl">Body Stats</div>
  <div class="body-metrics-grid" id="body-metrics"></div>
  <div style="padding:10px 16px"><button class="btn btn-primary" id="log-body-btn">+ Log Today's Stats</button></div>

  <div class="sec-lbl">Push-Up Tracker</div>
  <div class="pushup-card">
    <div style="flex:1">
      <div style="font-size:15px;font-weight:700">Today's Push-Ups</div>
      <div style="font-size:12px;color:var(--text3);margin-top:3px">Track every upper body session</div>
    </div>
    <div class="pushup-val" id="pushup-val">0</div>
    <div class="pushup-controls">
      <button class="pu-btn" id="pu-up">â–²</button>
      <button class="pu-btn" id="pu-dn">â–¼</button>
    </div>
  </div>

  <div class="sec-lbl">Settings</div>
  <div class="settings-list">
    <div class="setting-row" id="theme-toggle-row">
      <div class="setting-icon">ğŸŒ™</div>
      <div class="setting-info"><div class="setting-title">Dark Mode</div><div class="setting-sub">Toggle light / dark</div></div>
      <label class="toggle-sw"><input type="checkbox" id="theme-toggle" checked><div class="toggle-track"></div></label>
    </div>
    <div class="setting-row" id="notif-perm-row">
      <div class="setting-icon">ğŸ””</div>
      <div class="setting-info"><div class="setting-title">Notifications</div><div class="setting-sub" id="notif-status">Tap to allow reminders</div></div>
      <label class="toggle-sw"><input type="checkbox" id="notif-toggle"><div class="toggle-track"></div></label>
    </div>
    <div class="setting-row" id="cal-target-row">
      <div class="setting-icon">âš¡</div>
      <div class="setting-info"><div class="setting-title">Calorie Targets</div><div class="setting-sub" id="cal-target-sub">2,200 kcal Â· P:110g C:303g F:61g</div></div>
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="setting-right"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
  </div>

  <div class="sec-lbl">Plan Phase</div>
  <div id="phase-up-banner" style="display:none">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
      <div style="font-size:12px;font-weight:700;color:var(--accent)">ğŸ”º Phase Up Available</div>
      <div id="phase-up-dismiss" style="font-size:11px;color:var(--text3);cursor:pointer;background:var(--fill2);padding:4px 10px;border-radius:100px">Dismiss</div>
    </div>
    <div id="phase-up-text" style="font-size:13px;color:var(--text2);line-height:1.6;margin-bottom:12px">Time to advance to the next phase.</div>
    <button id="phase-up-btn" style="background:var(--accent);color:#fff;border:none;padding:12px 20px;font-size:14px;font-weight:700;cursor:pointer;border-radius:var(--r-md);width:100%;letter-spacing:.1px">Advance to Next Phase â†’</button>
  </div>
  <div class="settings-list">
    <div class="setting-row" id="plan-phase-row">
      <div class="setting-icon">ğŸ“…</div>
      <div class="setting-info"><div class="setting-title">Current Plan Phase</div><div class="setting-sub" id="plan-phase-sub">Year 1 Â· Month 1â€“3 Â· Foundation</div></div>
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="setting-right"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
    <div class="setting-row" id="view-targets-row">
      <div class="setting-icon">ğŸ—ºï¸</div>
      <div class="setting-info"><div class="setting-title">View Phase Targets</div><div class="setting-sub">Browse all 6 phases</div></div>
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="setting-right"><polyline points="9 18 15 12 9 6"/></svg>
    </div>
  </div>

  <div class="sec-lbl">Year 1 Progress</div>
  <div class="progress-section">
    <div class="progress-card">
      <div class="progress-label-row">
        <div class="progress-label">Weight Loss</div>
        <div class="progress-range" id="prog-w-lbl">92 â†’ 70 kg</div>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="prog-w" style="width:0%"></div></div>
      <div class="progress-label-row" style="margin-top:16px">
        <div class="progress-label">Waist</div>
        <div class="progress-range">38 â†’ 29 in</div>
      </div>
      <div class="progress-bar"><div class="progress-fill green" id="prog-ws" style="width:0%"></div></div>
    </div>
  </div>

  <div class="sec-lbl">Current Phase Targets</div>
  <div id="phase-targets-card" style="padding:0 16px"></div>

  <div class="sec-lbl">2-Year Roadmap</div>
  <div class="roadmap-card" id="roadmap-card"></div>

  <div class="sec-lbl">Milestones</div>
  <div style="padding:0 16px;display:flex;flex-direction:column;gap:8px;padding-bottom:4px" id="milestones-list"></div>
  <div style="height:16px"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•â•â•â• -->
<nav>
  <button class="nav-btn active" data-page="home">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    <span>Home</span>
  </button>
  <button class="nav-btn" data-page="workout">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M6.5 6.5h11M6.5 17.5h11M2 12h4m12 0h4"/><circle cx="6" cy="12" r="2"/><circle cx="18" cy="12" r="2"/></svg>
    <span>Workout</span>
  </button>
  <button class="nav-btn" data-page="cal">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 2a9 9 0 100 18A9 9 0 0012 2z"/><path d="M8.5 14s1.5 2 3.5 2 3.5-2 3.5-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
    <span>Calories</span>
  </button>
  <button class="nav-btn" data-page="reports">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
    <span>Reports</span>
  </button>
  <button class="nav-btn" data-page="profile">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    <span>Profile</span>
  </button>
</nav>

<!-- SHEET OVERLAY -->
<div class="sheet-overlay" id="sheet-overlay"></div>

<!-- GYM TIME SHEET -->
<div class="sheet" id="gym-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">Set Gym Time</div>
  <div class="sheet-sub">Reminders for pre-workout meal, water, and warmup will be scheduled automatically.</div>
  <div class="inp-group"><label class="inp-label">Gym Time Today</label><input type="time" class="inp" id="gym-time-inp"></div>
  <div class="inp-group"><label class="inp-label">Pre-Workout Lead Time</label>
    <select class="inp" id="preworkout-lead"><option value="30">30 minutes before</option><option value="45" selected>45 minutes before</option><option value="60">60 minutes before</option></select>
  </div>
  <div class="inp-group"><button class="btn btn-primary" id="gym-time-save">Save Gym Time</button></div>
</div>

<!-- FOOD ADD SHEET -->
<div class="sheet" id="food-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">Add Food</div>
  <div class="inp-group"><label class="inp-label">Food Name</label><input type="text" class="inp" id="f-name" placeholder="e.g. Dal 1 Bowl"></div>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:0">
    <div class="inp-group"><label class="inp-label">Calories</label><input type="number" class="inp" id="f-kcal" placeholder="150" inputmode="numeric"></div>
    <div class="inp-group"><label class="inp-label">Protein (g)</label><input type="number" class="inp" id="f-p" placeholder="9" inputmode="numeric"></div>
    <div class="inp-group"><label class="inp-label">Carbs (g)</label><input type="number" class="inp" id="f-c" placeholder="25" inputmode="numeric"></div>
    <div class="inp-group"><label class="inp-label">Fat (g)</label><input type="number" class="inp" id="f-f" placeholder="2" inputmode="numeric"></div>
  </div>
  <div class="inp-group"><button class="btn btn-primary" id="food-save">Add Food</button></div>
</div>

<!-- BODY LOG SHEET -->
<div class="sheet" id="body-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">Log Stats</div>
  <div class="inp-group"><label class="inp-label">Weight (kg)</label><input type="number" class="inp" id="bl-w" placeholder="91.7" inputmode="decimal"></div>
  <div class="inp-group"><label class="inp-label">Waist (inches)</label><input type="number" class="inp" id="bl-ws" placeholder="38" inputmode="decimal"></div>
  <div class="inp-group"><label class="inp-label">Resting HR (bpm)</label><input type="number" class="inp" id="bl-rhr" placeholder="80" inputmode="numeric"></div>
  <div class="inp-group"><label class="inp-label">Sleep (hours)</label><input type="number" class="inp" id="bl-sl" placeholder="7" inputmode="decimal"></div>
  <div class="inp-group"><button class="btn btn-primary" id="body-save">Save Stats</button></div>
</div>

<!-- PLAN PHASE SHEET -->
<div class="sheet" id="phase-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">Select Phase</div>
  <div class="sheet-sub">Calorie and macro targets update automatically when you change phase.</div>
  <div style="padding:0 22px 20px;display:flex;flex-direction:column;gap:8px" id="phase-options"></div>
</div>

<!-- VIEW TARGETS SHEET -->
<div class="sheet" id="targets-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">Phase Targets</div>
  <div class="sheet-sub">Select any phase to preview its nutrition & body targets.</div>
  <div class="inp-group"><select class="inp" id="target-phase-select"></select></div>
  <div id="target-phase-preview" style="padding:0 22px 24px"></div>
</div>

<!-- CALORIE TARGET SHEET -->
<div class="sheet" id="cal-target-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">Calorie Targets</div>
  <div class="sheet-sub">Choose a preset based on your current bodyweight or enter custom values. Protein is set at 1.2g/kg.</div>
  <div class="inp-group">
    <label class="inp-label">Preset (by bodyweight)</label>
    <select class="inp" id="cal-preset-select">
      <option value="">â€” Select Preset â€”</option>
      <option value="2200|110|303|61">92 kg Â· 2,200 kcal Â· P:110g C:303g F:61g</option>
      <option value="2162|108|298|60">90 kg Â· 2,162 kcal Â· P:108g C:298g F:60g</option>
      <option value="2123|106|292|59">88 kg Â· 2,123 kcal Â· P:106g C:292g F:59g</option>
      <option value="2065|102|286|57">85 kg Â· 2,065 kcal Â· P:102g C:286g F:57g</option>
      <option value="2008|98|278|56">82 kg Â· 2,008 kcal Â· P:98g C:278g F:56g</option>
      <option value="1950|95|271|54">79 kg Â· 1,950 kcal Â· P:95g C:271g F:54g</option>
      <option value="1892|91|263|53">76 kg Â· 1,892 kcal Â· P:91g C:263g F:53g</option>
      <option value="1873|90|261|52">75 kg Â· 1,873 kcal Â· P:90g C:261g F:52g</option>
      <option value="1815|86|255|50">72 kg Â· 1,815 kcal Â· P:86g C:255g F:50g</option>
      <option value="1777|84|250|49">70 kg Â· 1,777 kcal Â· P:84g C:250g F:49g</option>
      <option value="custom">Customâ€¦</option>
    </select>
  </div>
  <div id="cal-custom-fields" style="display:none">
    <div class="inp-group"><label class="inp-label">Calories (kcal)</label><input type="number" class="inp" id="ct-kcal" placeholder="2200" inputmode="numeric"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;padding:0 22px">
      <div><label class="inp-label" style="font-size:10px">Protein (g)</label><input type="number" class="inp" id="ct-p" placeholder="110" inputmode="numeric"></div>
      <div><label class="inp-label" style="font-size:10px">Carbs (g)</label><input type="number" class="inp" id="ct-c" placeholder="303" inputmode="numeric"></div>
      <div><label class="inp-label" style="font-size:10px">Fat (g)</label><input type="number" class="inp" id="ct-f" placeholder="61" inputmode="numeric"></div>
    </div>
  </div>
  <div class="inp-group" style="margin-top:8px"><button class="btn btn-primary" id="cal-target-save">Save Targets</button></div>
</div>

<!-- BURN CONFIRM SHEET -->
<div class="sheet" id="burn-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">Calories Burned</div>
  <div class="sheet-sub" id="burn-sheet-sub">Estimated from your exercises:</div>
  <div style="text-align:center;padding:20px">
    <div class="burn-sheet-big" id="burn-estimate">0</div>
    <div style="font-size:12px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-top:6px">kcal estimated</div>
  </div>
  <div class="inp-group"><label class="inp-label">Adjust if needed</label><input type="number" class="inp" id="burn-adjust" inputmode="numeric"></div>
  <div class="inp-group"><button class="btn btn-primary" id="burn-confirm">Confirm Burn</button></div>
</div>

<!-- WEIGHT SUGGEST SHEET -->
<div class="sheet" id="weight-suggest-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-title">Update Calories?</div>
  <div class="sheet-sub" id="wss-sub">Your 7-day average weight suggests your targets should update.</div>
  <div style="margin:0 22px 16px;background:var(--card);border-radius:var(--r-lg);border:1px solid var(--border3);overflow:hidden">
    <div style="padding:14px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
      <div style="font-size:13px;color:var(--text3)">7-day Avg Weight</div>
      <div style="font-size:17px;font-weight:800;color:var(--text)" id="wss-avg-weight">â€”</div>
    </div>
    <div style="padding:14px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center">
      <div style="font-size:13px;color:var(--text3)">Current Calories</div>
      <div style="font-size:17px;font-weight:800;color:var(--text3)" id="wss-cur-kcal">â€”</div>
    </div>
    <div style="padding:14px 18px;display:flex;justify-content:space-between;align-items:center;background:var(--accent-soft)">
      <div style="font-size:13px;color:var(--accent)">Suggested Calories</div>
      <div style="font-size:17px;font-weight:800;color:var(--accent)" id="wss-new-kcal">â€”</div>
    </div>
  </div>
  <div style="padding:0 22px;font-size:13px;color:var(--text3);line-height:1.6;margin-bottom:16px" id="wss-macro-preview"></div>
  <div class="inp-group"><button class="btn btn-primary" id="wss-apply">Apply New Targets</button></div>
  <div class="inp-group" style="padding-top:0"><button class="btn btn-ghost" id="wss-dismiss">Keep Current</button></div>
</div>

</div><!-- /app -->

<!-- ACTIVE SESSION OVERLAY -->
<div id="active-session">
  <div class="as-header">
    <div class="as-close" id="as-close">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </div>
    <div class="as-title-wrap">
      <div class="as-session-name" id="as-session-name">UPPER STRENGTH</div>
      <div class="as-ex-count" id="as-ex-count">Exercise 1 of 8</div>
    </div>
    <div class="as-timer-wrap">
      <div class="as-timer" id="as-timer">00:00</div>
      <div class="as-live-burn" id="as-live-burn">0 kcal</div>
    </div>
  </div>
  <div class="as-progress-row">
    <div style="font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.4px;width:60px">Progress</div>
    <div style="flex:1" class="prog-track"><div class="prog-fill" id="as-prog-bar" style="width:0%"></div></div>
    <div class="as-prog-val" id="as-prog-val">0%</div>
  </div>
  <div class="as-body" id="as-body"></div>
  <div class="as-footer">
    <button class="btn btn-ghost" style="flex:1" id="as-prev-btn">â† Prev</button>
    <button class="btn btn-primary" style="flex:2" id="as-next-btn">Next â†’</button>
  </div>
</div>

<!-- REST TIMER -->
<div class="rest-overlay" id="rest-overlay">
  <div class="rest-title">Rest Period</div>
  <div class="rest-big" id="rest-countdown">02:00</div>
  <div class="rest-next" id="rest-next-info">Next: â€”</div>
  <button class="rest-skip" id="rest-skip">Skip Rest â†’</button>
</div>

<!-- SESSION COMPLETE -->
<div class="session-complete" id="session-complete">
  <div class="sc-icon">ğŸ†</div>
  <div class="sc-title">Session<br>Complete</div>
  <div class="sc-subtitle">Another brick in the wall.</div>
  <div class="sc-stats" id="sc-stats"></div>
  <button class="btn btn-primary" id="sc-done-btn" style="width:100%">Back to Workout</button>
</div>

<div class="toast" id="toast"></div>
<button class="fab" id="fab">+</button>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALORIE BURN ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcSetKcal(ex, weight, reps, bodyWeight) {
  if (isCardioEx(ex)) return 0;
  const repTimeSec = 3;
  const timeHrs = (reps * repTimeSec) / 3600;
  let met = 4.5;
  const name = (ex.n || '').toLowerCase();
  if (name.includes('squat') || name.includes('leg press') || name.includes('rdl') || name.includes('lunge')) met = 6;
  else if (name.includes('press') || name.includes('row') || name.includes('pull')) met = 5;
  else if (name.includes('plank') || name.includes('hold')) met = 3.5;
  else if (name.includes('curl') || name.includes('extension') || name.includes('raise')) met = 4;
  else if (name.includes('push-up') || name.includes('dip')) met = 5;
  else if (name.includes('mountain') || name.includes('climber')) met = 7;
  const weightFactor = weight > 0 ? 1 + (weight / 100) * 0.3 : 1;
  const kcal = met * bodyWeight * timeHrs * weightFactor;
  return Math.max(1, Math.round(kcal));
}
function calcCardioKcal(ex, durationMin, bodyWeight) {
  const name = (ex.n || '').toLowerCase();
  let met = 4;
  if (name.includes('walk') || name.includes('brisk')) met = 4;
  if (name.includes('jog') || name.includes('run')) met = 8;
  if (name.includes('mountain')) met = 8;
  return Math.round(met * bodyWeight * (durationMin / 60));
}
function isCardioEx(ex) { return !!(ex.isCardio) }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA â€” Updated for new plan
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DAYS_SHORT = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

// PLAN PHASES â€” Updated: 6K in 25 min, protein 1.2g/kg, no dairy
const PLAN_PHASES = [
  { id:1, year:1, months:'1â€“3', name:'Foundation', weight:'88â€“92 kg', waist:'35â€“37 in',
    kcal:2200, protein:110, carbs:303, fat:61,
    cardio:'Walk 30 min Â· HR < 140 bpm',
    focus:'Learn movements, build cardio base, lose first 6â€“8 kg. Walk to gym every session.' },
  { id:2, year:1, months:'4â€“5', name:'Walk-Run', weight:'82â€“88 kg', waist:'33â€“35 in',
    kcal:2085, protein:103, carbs:288, fat:58,
    cardio:'Walk-run intervals Â· Run 3 min non-stop',
    focus:'Introduce running, strength PRs, visible fat loss. Build to 4K run.' },
  { id:3, year:1, months:'6â€“7', name:'Endurance', weight:'77â€“82 kg', waist:'31â€“33 in',
    kcal:1950, protein:95, carbs:271, fat:54,
    cardio:'Run 4â€“5K continuously Â· Zone 2',
    focus:'5K running base, physique shaping, strength foundation building.' },
  { id:4, year:1, months:'8â€“9', name:'Distance Lock', weight:'73â€“77 kg', waist:'29â€“31 in',
    kcal:1873, protein:90, carbs:261, fat:52,
    cardio:'Run 6K continuously (no time target)',
    focus:'Lock in 6K distance. Visible V-taper beginning. Solid strength base.' },
  { id:5, year:1, months:'10â€“11', name:'Speed Work', weight:'71â€“73 kg', waist:'28â€“30 in',
    kcal:1815, protein:86, carbs:255, fat:50,
    cardio:'Intervals: 4Ã—600m hard Â· 6K under 28 min',
    focus:'Speed training begins. Shredded physique. 6K sub-28 min.' },
  { id:6, year:1, months:'12', name:'Race Ready', weight:'70â€“72 kg', waist:'27â€“29 in',
    kcal:1796, protein:85, carbs:252, fat:50,
    cardio:'Race pace efforts Â· 6K in 25 min âœ“',
    focus:'Peak condition. 6K in 25 minutes. Lean, dense, shredded V-taper.' },
];

const MILESTONES = [
  { period:'Week 1â€“4',   weight:'88â€“91 kg', waist:'~37 in', cardio:'Walk 25 min, HR settling',     look:'Very slightly leaner, better energy' },
  { period:'Week 5â€“8',   weight:'84â€“87 kg', waist:'~36 in', cardio:'Walk 30 min, HR < 140',        look:'Noticeably leaner, jawline thinner' },
  { period:'Week 9â€“12',  weight:'79â€“82 kg', waist:'~34 in', cardio:'Walk-jog intervals',           look:'V-taper emerging, arms defined' },
  { period:'Month 4â€“5',  weight:'76â€“79 kg', waist:'~32 in', cardio:'Run 4K continuously',          look:'Athletic, lean, clear muscle definition' },
  { period:'Month 6â€“7',  weight:'73â€“76 kg', waist:'~31 in', cardio:'Run 5K easy',                  look:'Shredded, clear V-taper visible' },
  { period:'Month 8â€“9',  weight:'71â€“73 kg', waist:'~29 in', cardio:'Run 6K (any pace)',             look:'Lean and dense. Physique earns respect.' },
  { period:'Month 10â€“12',weight:'70â€“72 kg', waist:'~27 in', cardio:'6K in 25 min âœ“',               look:'Lean, shredded, fast. Goal hit.' },
];

const WORKOUTS = [
  { name:'UPPER STRENGTH', meta:'Chest + Back Â· ~55 min', tag:'Day 1', met:5,
    exercises:[
      {n:'Smith Machine Bench Press', plan:'3â†’4 sets Â· 6â€“8 reps', planWeight:32.5, eq:'Smith Machine', tip:'Lower bar to chest. Explosive drive up. Pause 1 sec on chest.', startWeight:32.5, increment:2.5},
      {n:'Assisted Pull-Ups', plan:'3 sets Â· 3â€“5 reps', planWeight:0, eq:'Pull-up bar', tip:'Dead hang start, chin clears bar. Control 3-sec negative.', startWeight:0, increment:0},
      {n:'Smith Bent-Over Row', plan:'3 sets Â· 8â€“10 reps', planWeight:27.5, eq:'Smith Machine', tip:'Flat back. Pull bar to navel. Hard squeeze at top.', startWeight:27.5, increment:2.5},
      {n:'DB Overhead Press (seated)', plan:'3 sets Â· 8â€“10 reps', planWeight:9, eq:'Dumbbells', tip:'Elbows at 90Â°. Press straight overhead. Full lockout.', startWeight:9, increment:1},
      {n:'Incline DB Press', plan:'3 sets Â· 8â€“10 reps', planWeight:9, eq:'DB + Bench', tip:'Upper chest focus. Controlled 3-sec descent.', startWeight:9, increment:1},
      {n:'Face Pulls', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Cable', tip:'Elbows high. Pull to forehead level.', startWeight:0, increment:0},
      {n:'Plank', plan:'3 sets Â· 25 sec (add 5 sec/week)', planWeight:0, eq:'Bodyweight', tip:'Straight line head to heels. Do NOT let hips sag.', startWeight:0, increment:0},
      {n:'Push-Up Practice', plan:'2 sets Â· Max reps', planWeight:0, eq:'Bodyweight', tip:'Track every rep. Aim +1 each session. Start on bench if floor too hard.', startWeight:0, increment:0},
    ]},
  { name:'LOWER STRENGTH', meta:'Legs + Glutes Â· ~55 min', tag:'Day 2', met:6,
    exercises:[
      {n:'Smith Machine Squat', plan:'3â†’4 sets Â· 8â€“10 reps', planWeight:35, eq:'Smith Machine', tip:'Knees track over toes. Break parallel. Control descent.', startWeight:35, increment:2.5},
      {n:'Leg Press', plan:'3 sets Â· 10â€“12 reps', planWeight:55, eq:'Machine', tip:'Full ROM. Do not lock out at top.', startWeight:55, increment:5},
      {n:'Smith Machine RDL', plan:'3 sets Â· 8â€“10 reps', planWeight:35, eq:'Smith Machine', tip:'Hinge at hips, back flat. Feel hamstring stretch at bottom.', startWeight:35, increment:2.5},
      {n:'Walking Lunges', plan:'3 sets Â· 10/leg', planWeight:0, eq:'Bodyweight', tip:'Long step. Rear knee stops just before floor.', startWeight:0, increment:0},
      {n:'Leg Curl', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Machine', tip:'Full extension, full curl. 4-sec slow negative.', startWeight:0, increment:0},
      {n:'Leg Extension', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Machine', tip:'Squeeze hard at top. Slow descent.', startWeight:0, increment:0},
      {n:'Standing Calf Raises', plan:'3 sets Â· 20â€“25 reps', planWeight:0, eq:'BW / Machine', tip:'Heel fully below platform. Full stretch at bottom.', startWeight:0, increment:0},
      {n:'Hanging Knee Raises', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Pull-up bar', tip:'Pull knees to chest. Control the descent.', startWeight:0, increment:0},
    ]},
  { name:'CARDIO + CORE', meta:'Fat Burn Â· ~50 min', tag:'Day 3', met:5,
    exercises:[
      {n:'Brisk Walk / Jog', plan:'20â€“30 min Â· Zone 2 Â· HR 119â€“139', planWeight:0, eq:'Outdoor', tip:'Follow the 6K roadmap phase. If you cannot speak a full sentence, slow down.', startWeight:0, increment:0, isCardio:true},
      {n:'Plank', plan:'3 sets Â· 25â€“30 sec', planWeight:0, eq:'Bodyweight', tip:'Add 5 sec per week. Target 60 sec by Week 6.', startWeight:0, increment:0},
      {n:'Leg Raises', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Bodyweight', tip:'Slow and controlled. Lower abs.', startWeight:0, increment:0},
      {n:'Russian Twists', plan:'3 sets Â· 20 reps', planWeight:0, eq:'Bodyweight', tip:'Bodyweight first. Add light plate from Week 5.', startWeight:0, increment:0},
      {n:'Dead Bug', plan:'3 sets Â· 8/side', planWeight:0, eq:'Bodyweight', tip:'Press lower back into floor the entire time.', startWeight:0, increment:0},
      {n:'Cable Woodchops', plan:'3 sets Â· 10/side', planWeight:0, eq:'Cable', tip:'Rotational core. Functional strength.', startWeight:0, increment:0},
      {n:'Mountain Climbers', plan:'2 sets Â· 25 sec', planWeight:0, eq:'Bodyweight', tip:'If HR > 155 bpm â€” stop and rest.', startWeight:0, increment:0},
      {n:'Hollow Body Hold', plan:'2 sets Â· 20 sec', planWeight:0, eq:'Bodyweight', tip:'Lower back stays on floor the whole time.', startWeight:0, increment:0},
    ]},
  { name:'UPPER HYPERTROPHY', meta:'Volume + Arms Â· ~55 min', tag:'Day 4', met:5,
    exercises:[
      {n:'Incline DB Press', plan:'4 sets Â· 10â€“12 reps', planWeight:9, eq:'DB + Bench', tip:'Upper chest. 60â€“75 sec rest strictly.', startWeight:9, increment:1},
      {n:'Seated Cable Row', plan:'4 sets Â· 10â€“12 reps', planWeight:0, eq:'Cable', tip:'Hard squeeze at full contraction. Hold 1 sec.', startWeight:0, increment:0},
      {n:'Lat Pulldown', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Cable', tip:'Wide lats = V-taper. Pull bar to upper chest.', startWeight:0, increment:0},
      {n:'Cable Fly / Pec Deck', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Cable', tip:'2-sec squeeze at peak contraction every rep.', startWeight:0, increment:0},
      {n:'DB Bicep Curls', plan:'3 sets Â· 10â€“12 reps', planWeight:8, eq:'Dumbbells', tip:'3-sec slow negative. No swinging.', startWeight:8, increment:1},
      {n:'Rope Pushdowns', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Cable', tip:'Full extension at bottom. Elbows pinned at sides.', startWeight:0, increment:0},
      {n:'Hammer Curls', plan:'2 sets Â· 12 reps', planWeight:8, eq:'Dumbbells', tip:'Brachialis. Adds arm thickness.', startWeight:8, increment:1},
      {n:'Rear Delt Cable Fly', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Cable', tip:'Elbows wide. Pull back and apart.', startWeight:0, increment:0},
      {n:'Plank + Shoulder Taps', plan:'3 sets Â· 20 taps', planWeight:0, eq:'Bodyweight', tip:'Hips must stay perfectly square.', startWeight:0, increment:0},
    ]},
  { name:'LOWER + CARDIO', meta:'RDL Focus Â· ~55 min', tag:'Day 5', met:6,
    exercises:[
      {n:'Smith Machine RDL (Heavy)', plan:'4 sets Â· 6â€“8 reps', planWeight:40, eq:'Smith Machine', tip:'Primary strength lift. Add weight weekly.', startWeight:40, increment:2.5},
      {n:'Bulgarian Split Squat', plan:'3 sets Â· 8/leg', planWeight:0, eq:'BW / DB', tip:'Rear foot elevated. Deep front lunge. Control.', startWeight:0, increment:0},
      {n:'Leg Press', plan:'3 sets Â· 12â€“15 reps', planWeight:65, eq:'Machine', tip:'Higher reps for pump and definition.', startWeight:65, increment:5},
      {n:'Hip Thrust', plan:'3 sets Â· 12 reps', planWeight:0, eq:'BW / Smith', tip:'Glute squeeze at top. Hold 1 full second each rep.', startWeight:0, increment:0},
      {n:'Leg Extension', plan:'3 sets Â· 15 reps', planWeight:0, eq:'Machine', tip:'Slow and controlled.', startWeight:0, increment:0},
      {n:'Seated Calf Raise', plan:'3 sets Â· 20 reps', planWeight:0, eq:'Machine', tip:'Full range. Calves love volume.', startWeight:0, increment:0},
      {n:'Brisk Walk / Easy Jog', plan:'15 min finisher Â· Zone 2', planWeight:0, eq:'Outdoor', tip:'Fat burn on glycogen-depleted legs. Keep Zone 2.', startWeight:0, increment:0, isCardio:true},
    ]},
  { name:'SHOULDERS + ARMS', meta:'V-Taper Day Â· ~50 min', tag:'Day 6', met:5,
    exercises:[
      {n:'DB Shoulder Press (seated)', plan:'4 sets Â· 8â€“10 reps', planWeight:11, eq:'Dumbbells', tip:'Full ROM and control.', startWeight:11, increment:1},
      {n:'Lateral Raises (DB)', plan:'4 sets Â· 12â€“15 reps', planWeight:5, eq:'Dumbbells', tip:'SLOW: 2s up Â· 2s hold Â· 3s down. Feel it in SIDE delt only.', startWeight:5, increment:0.5},
      {n:'Cable Lateral Raises', plan:'3 sets Â· 15 reps', planWeight:0, eq:'Cable', tip:'Better bottom tension than DB.', startWeight:0, increment:0},
      {n:'Rear Delt Cable Fly', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Cable', tip:'Elbows wide. Pull back and apart. 3D shoulder.', startWeight:0, increment:0},
      {n:'Smith Machine OHP (standing)', plan:'3 sets Â· 8â€“10 reps', planWeight:22.5, eq:'Smith Machine', tip:'Push for strength progression each session.', startWeight:22.5, increment:2.5},
      {n:'EZ Bar / DB Curl', plan:'3 sets Â· 8â€“10 reps', planWeight:11, eq:'Dumbbells', tip:'Full ROM. No swinging at top.', startWeight:11, increment:1},
      {n:'Incline DB Curl', plan:'3 sets Â· 10â€“12 reps', planWeight:7, eq:'DB + Bench', tip:'Stretch at bottom = fuller bicep shape.', startWeight:7, increment:0.5},
      {n:'Overhead Tricep Extension', plan:'3 sets Â· 10â€“12 reps', planWeight:0, eq:'Cable / DB', tip:'Long head. Arms look bigger from all angles.', startWeight:0, increment:0},
      {n:'Tricep Bench Dips', plan:'3 sets Â· 12â€“15 reps', planWeight:0, eq:'Bench', tip:'Elbows close to body. Definition finisher.', startWeight:0, increment:0},
    ]},
  { name:'REST DAY', meta:'Full Recovery Â· Light walk optional', tag:'Rest', met:1.5,
    exercises:[
      {n:'Light Home Walk', plan:'20 min optional Â· Zone 1', planWeight:0, eq:'Outdoor', tip:'Active recovery. Enjoy it.', startWeight:0, increment:0, isCardio:true},
      {n:'Stretching', plan:'Hip flexors, hamstrings, shoulders', planWeight:0, eq:'Home', tip:'Hold each stretch 30+ seconds.', startWeight:0, increment:0},
      {n:'10:15 PM Alarm', plan:'Set tonight â€” protect sleep', planWeight:0, eq:'Phone', tip:'Sleep is training. 7 hours minimum.', startWeight:0, increment:0},
    ]},
];

// UPDATED: No dairy, Dharan-available foods, no paneer/milk dependency
const QUICK_FOODS = [
  {name:'Dal (1 bowl)',icon:'ğŸ²',kcal:150,p:9,c:25,f:2},
  {name:'Soy Chunks (50g)',icon:'ğŸŒ±',kcal:175,p:25,c:12,f:1},
  {name:'Sattu (30g)',icon:'ğŸ’ª',kcal:120,p:11,c:16,f:2},
  {name:'2 Boiled Eggs',icon:'ğŸ¥š',kcal:140,p:12,c:0,f:10},
  {name:'Rice (1 cup)',icon:'ğŸš',kcal:200,p:4,c:44,f:0},
  {name:'Chicken (100g)',icon:'ğŸ—',kcal:165,p:31,c:0,f:4},
  {name:'Peanuts (30g)',icon:'ğŸ¥œ',kcal:170,p:8,c:5,f:14},
  {name:'Banana',icon:'ğŸŒ',kcal:90,p:1,c:23,f:0},
  {name:'Roti (1)',icon:'ğŸ«“',kcal:100,p:3,c:20,f:1},
  {name:'Chana (100g)',icon:'ğŸ«˜',kcal:164,p:9,c:27,f:3},
];

const QUOTES = [
  "70 kg. 27-inch waist. 6K in 25 minutes. Already decided. Earn it today.",
  "The gym is 1 km away. That walk is already your cardio.",
  "Sleep is training. 10:15 pm. Wind down. Non-negotiable.",
  "Zone 2 check: can you speak a full sentence? No? Slow down.",
  "Never miss twice. One is life. Two is a warning. Three is a dropout.",
  "Dal, sattu, soy chunks, and a Smith machine. That's all you need.",
  "Your only competition is yesterday's version of you.",
  "Muscle is built during sleep. Every hour before midnight counts double.",
  "Drink your water. Pale yellow urine â€” that is the check.",
  "Protein target drops as you lose weight. It gets easier.",
  "Discipline is the bridge between goals and accomplishment.",
  "Every rep. Every set. Every bowl of dal. It all adds up.",
  "V-taper is built on lateral raises done slowly and correctly.",
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function today() { return new Date().toISOString().slice(0,10) }
function load() { try { return JSON.parse(localStorage.getItem('trnx3')||'{}') } catch { return {} } }
function save() { try { localStorage.setItem('trnx3', JSON.stringify(S)) } catch(e) { /* storage unavailable */ } }

let S = load();
if(!S.streak)        S.streak=0;
if(!S.pushups)       S.pushups=0;
if(!S.streakLast)    S.streakLast='';
if(!S.gymTime)       S.gymTime='';
if(!S.theme)         S.theme='dark';
if(!S.bodyLogs)      S.bodyLogs=[];
if(!S.calLog)        S.calLog={};
if(!S.workoutLog)    S.workoutLog={};
if(!S.burnLog)       S.burnLog={};
if(!S.waterLog)      S.waterLog={};
if(!S.preworkoutLead) S.preworkoutLead=45;
if(!S.calTarget)     S.calTarget={kcal:2200,p:110,c:303,f:61};
if(!S.exercisePR)    S.exercisePR={};
if(!S.phaseStartDate) S.phaseStartDate=today();
if(!S.planPhase)     S.planPhase=1;
if(!S.age)           S.age=21;
if(!S.height)        S.height=174;

let currentPage='home';
let activeDayIdx=new Date().getDay();

// â”€â”€ UTILS â”€â”€
function todayWater()   { return S.waterLog[today()]||0 }
function todayCalLog()  { return S.calLog[today()]||[] }
function todayBurn()    { return S.burnLog[today()]||0 }
function todayTotals()  {
  return todayCalLog().reduce((a,f)=>{a.kcal+=f.kcal||0;a.p+=f.p||0;a.c+=f.c||0;a.f+=f.f||0;return a},{kcal:0,p:0,c:0,f:0});
}

function showToast(msg, dur=2500) {
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), dur);
}

const sheetOverlay=document.getElementById('sheet-overlay');
sheetOverlay.addEventListener('click', closeSheets);
function openSheet(id)  { document.getElementById(id).classList.add('show'); sheetOverlay.classList.add('show') }
function closeSheets()  { document.querySelectorAll('.sheet').forEach(s=>s.classList.remove('show')); sheetOverlay.classList.remove('show') }

function applyTheme(t) {
  document.documentElement.setAttribute('data-theme', t);
  S.theme=t; save();
  document.getElementById('theme-meta').content=t==='dark'?'#000000':'#F2F2F7';
  document.getElementById('theme-toggle').checked=t==='dark';
}
applyTheme(S.theme||'dark');
document.getElementById('theme-toggle').addEventListener('change', function(){ applyTheme(this.checked?'dark':'light') });

// â”€â”€ BMR / TDEE â”€â”€
function calcBMR() {
  const last=S.bodyLogs[S.bodyLogs.length-1];
  const weight=last?last.weight:91.7;
  return Math.round(10*weight + 6.25*S.height - 5*S.age + 5);
}
function calcNEAT() { return S.neat||150 }
function getCurrentPhase() { return PLAN_PHASES.find(p=>p.id===S.planPhase)||PLAN_PHASES[0] }

// â”€â”€ MACRO TARGETS BY WEIGHT (1.2g/kg) â”€â”€
function getCalTargetForWeight(w) {
  const planCal = Math.round(2200 - ((92-w)/(92-72)) * 385);
  const protein  = Math.round(1.2 * w);
  const fat      = Math.round((planCal * 0.25) / 9);
  const carbs    = Math.round((planCal - protein * 4 - fat * 9) / 4);
  return { kcal: planCal, p: protein, c: carbs, f: fat };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const fab=document.getElementById('fab');
fab.addEventListener('click',()=>{ if(currentPage==='cal') openSheet('food-sheet'); if(currentPage==='profile') openSheet('body-sheet') });

document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const pg=btn.dataset.page;
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('page-'+pg).classList.add('active');
    currentPage=pg;
    fab.style.display=(pg==='cal'||pg==='profile')?'flex':'none';
    if(pg==='home')    renderHome();
    if(pg==='workout') renderWorkout();
    if(pg==='cal')     renderCalories();
    if(pg==='reports') renderReports('week');
    if(pg==='profile') { renderProfile(); checkPhaseUpBanner(); }
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HOME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderHome() {
  const now=new Date();
  document.getElementById('hero-date').textContent=now.toLocaleDateString('en-US',{weekday:'long',day:'numeric',month:'long'}).toUpperCase();
  const h=now.getHours();
  document.getElementById('hero-word').textContent=h<12?'Rise.':h<17?'Grind.':'Build.';
  const q=QUOTES[now.getDate()%QUOTES.length];
  document.getElementById('hero-sub').textContent='"'+q+'"';
  document.getElementById('hero-quote2').textContent='"'+QUOTES[(now.getDate()+3)%QUOTES.length]+'"';

  const last=S.bodyLogs[S.bodyLogs.length-1];
  document.getElementById('h-weight').innerHTML=(last?last.weight:'â€”')+' <span class="ring-stat-unit">kg</span>';
  document.getElementById('streak-big').textContent=S.streak;
  document.getElementById('h-streak-sub').textContent=S.streak>0?`${S.streak} days straight`:'Start your streak today';

  const tot=todayTotals();
  const burn=todayBurn();
  const tgt=S.calTarget||{kcal:2200};
  const remain=Math.max(0, tgt.kcal + burn - tot.kcal);
  document.getElementById('h-cal').innerHTML=(tot.kcal||0)+' <span class="ring-stat-unit">kcal</span>';
  document.getElementById('tdee-net-home').innerHTML=burn+' <span class="ring-stat-unit">kcal</span>';
  document.getElementById('ring-remain-home').textContent=remain;

  // Ring arcs
  const calPct=Math.min(1, tot.kcal/(tgt.kcal||2200));
  const bmr=calcBMR(), bmrPct=Math.min(1, tot.kcal/bmr);
  document.getElementById('ring-arc').style.strokeDashoffset=339-(339*calPct);
  document.getElementById('ring-bmr').style.strokeDashoffset=239-(239*bmrPct);

  // Streak dots
  const dotsEl=document.getElementById('streak-dots');
  dotsEl.innerHTML='';
  for(let i=0;i<7;i++){
    const d=document.createElement('div');
    d.className='streak-dot'+(i<S.streak%8?' on':'');
    dotsEl.appendChild(d);
  }

  renderGymTime();
  renderWater();
  scheduleChecks();
}

function renderGymTime() {
  const gt=S.gymTime;
  const disp=document.getElementById('gym-time-display');
  const info=document.getElementById('preworkout-info');
  const countdown=document.getElementById('gym-countdown');
  if(!gt){disp.textContent='Set Time';info.textContent='â€”';countdown.textContent='â€”';return;}
  const [h,m]=gt.split(':').map(Number);
  const now=new Date();
  const gymDate=new Date(now); gymDate.setHours(h,m,0,0);
  const lead=S.preworkoutLead||45;
  const preDate=new Date(gymDate.getTime()-lead*60000);
  const fmt=d=>{let hrs=d.getHours(),mins=d.getMinutes();const ampm=hrs>=12?'PM':'AM';hrs=hrs%12||12;return`${hrs}:${String(mins).padStart(2,'0')} ${ampm}`;};
  disp.textContent=fmt(gymDate);
  info.textContent=`Pre-workout ${fmt(preDate)}`;
  const diffMs=gymDate-now;
  if(diffMs>0){const dh=Math.floor(diffMs/3600000);const dm=Math.floor((diffMs%3600000)/60000);countdown.textContent=dh>0?`${dh}h ${dm}m`:`${dm}m`;}
  else{countdown.textContent='GYM TIME!';countdown.style.color='var(--accent)';}
}

function renderWater() {
  const count=todayWater();
  document.getElementById('water-ml').textContent=(count*0.5).toFixed(1)+'L';
  const el=document.getElementById('water-cups');
  el.innerHTML='';
  for(let i=0;i<7;i++){
    const c=document.createElement('div');
    c.className='wcup'+(i<count?' filled':'');
    c.addEventListener('click',()=>{
      const cur=S.waterLog[today()]||0;
      S.waterLog[today()]=i<cur?i:i+1;
      save(); renderWater();
      if((S.waterLog[today()]||0)>=7) showToast('Hydration goal hit! ğŸ’§');
    });
    el.appendChild(c);
  }
}

function scheduleChecks() {
  const notif=document.getElementById('home-notif');
  const last=S.bodyLogs[S.bodyLogs.length-1];
  if(!last || (new Date()-new Date(last.date))>7*86400000) {
    notif.style.display='flex';
    document.getElementById('notif-title').textContent='Log your stats';
    document.getElementById('notif-sub').textContent='No body stats logged in 7+ days.';
  } else {
    notif.style.display='none';
  }
}

document.getElementById('gym-set-btn').addEventListener('click',()=>openSheet('gym-sheet'));
document.getElementById('gym-time-save').addEventListener('click',()=>{
  const t=document.getElementById('gym-time-inp').value;
  const lead=parseInt(document.getElementById('preworkout-lead').value)||45;
  if(t){S.gymTime=t;S.preworkoutLead=lead;save();renderGymTime();closeSheets();showToast('Gym time saved!');}
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// WORKOUT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderWorkout() {
  const now=new Date();
  document.getElementById('workout-date-sub').textContent=now.toLocaleDateString('en-US',{weekday:'long',day:'numeric',month:'long'});
  const scroll=document.getElementById('day-scroll');
  scroll.innerHTML='';
  DAYS_SHORT.forEach((d,i)=>{
    const chip=document.createElement('div');
    chip.className='day-chip'+(i===activeDayIdx?' selected':'');
    const done=S.workoutLog[getDayKey(i)];
    chip.innerHTML=`<div class="day-name">${d}</div><div class="day-num">${getDateOfDay(i)}</div><div class="day-dot${done?' done':''}"></div>`;
    chip.addEventListener('click',()=>{ activeDayIdx=i; renderWorkout(); });
    scroll.appendChild(chip);
  });
  const wo=WORKOUTS[activeDayIdx];
  document.getElementById('wk-day-tag').textContent=wo.tag;
  document.getElementById('wk-title').textContent=wo.name;
  document.getElementById('wk-meta').textContent=wo.meta;
  renderExerciseList(wo);
}

function getDayKey(i) { const d=new Date(); d.setDate(d.getDate()-(d.getDay()-i)); return d.toISOString().slice(0,10)+'-'+i; }
function getDateOfDay(i) { const d=new Date(); d.setDate(d.getDate()-(d.getDay()-i)); return d.getDate(); }

function renderExerciseList(wo) {
  const list=document.getElementById('ex-list');
  list.innerHTML='';
  const log=S.workoutLog[today()]||{};
  const done=wo.exercises.filter((_,i)=>log[wo.name+'-'+i]).length;
  document.getElementById('sesh-prog-bar').style.width=wo.exercises.length?(done/wo.exercises.length*100)+'%':'0%';
  document.getElementById('sesh-prog-val').textContent=`${done}/${wo.exercises.length}`;
  wo.exercises.forEach((ex,i)=>{
    const isDone=!!(log[wo.name+'-'+i]);
    const pr=S.exercisePR[ex.n]||0;
    const card=document.createElement('div');
    card.className='ex-card'+(isDone?' done':'');
    card.innerHTML=`
      <div class="ex-top">
        <div>
          <div class="ex-num">#${i+1}</div>
          <div class="ex-name">${ex.n}</div>
          <div class="ex-eq">${ex.eq}</div>
          <div class="ex-plan">${ex.plan}</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
          ${pr?`<div class="ex-pr">PR: ${pr}kg</div>`:''}
          <div class="ex-done-check${isDone?' checked':''}" data-i="${i}" data-name="${wo.name}">${isDone?'âœ“':''}</div>
        </div>
      </div>
      <div class="ex-tip">${ex.tip}</div>`;
    card.querySelector('.ex-done-check').addEventListener('click', function(e){
      e.stopPropagation();
      if(!S.workoutLog[today()]) S.workoutLog[today()]={};
      const k=wo.name+'-'+i;
      S.workoutLog[today()][k]=!S.workoutLog[today()][k];
      save(); renderExerciseList(wo);
    });
    list.appendChild(card);
  });
}

document.getElementById('start-session-btn').addEventListener('click',()=>startActiveSession(WORKOUTS[activeDayIdx]));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTIVE SESSION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sessionState={};
let sessionTimer=null, sessionSec=0, sessionBurn=0;

function startActiveSession(wo) {
  sessionState={ wo, exIdx:0, weights:{}, completedSets:{}, startTime:Date.now() };
  wo.exercises.forEach((ex,i)=>{ sessionState.weights[i]=ex.planWeight||0; });
  document.getElementById('active-session').className='visible';
  document.getElementById('as-session-name').textContent=wo.name;
  sessionSec=0; sessionBurn=0;
  clearInterval(sessionTimer);
  sessionTimer=setInterval(()=>{
    sessionSec++;
    const m=Math.floor(sessionSec/60), s=sessionSec%60;
    document.getElementById('as-timer').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    document.getElementById('as-live-burn').textContent=sessionBurn+' kcal';
  },1000);
  renderActiveExercise();
}

function renderActiveExercise() {
  const {wo,exIdx}=sessionState;
  const ex=wo.exercises[exIdx];
  const total=wo.exercises.length;
  document.getElementById('as-ex-count').textContent=`Exercise ${exIdx+1} of ${total}`;
  document.getElementById('as-prog-bar').style.width=((exIdx/total)*100)+'%';
  document.getElementById('as-prog-val').textContent=Math.round(exIdx/total*100)+'%';
  const w=sessionState.weights[exIdx]||0;
  const body=document.getElementById('as-body');
  const planSets=parseInt((ex.plan.match(/(\d+)(?:â†’\d+)? sets/)||[])[1])||3;
  const planReps=parseInt((ex.plan.match(/(\d+)[â€“-]?\d* reps/)||ex.plan.match(/(\d+) reps/)||[])[1])||10;
  const completedSets=sessionState.completedSets[exIdx]||{};
  body.innerHTML=`
    <div class="as-ex-num">Exercise ${exIdx+1} of ${total}</div>
    <div class="as-ex-name">${ex.n}</div>
    <div class="as-ex-plan">${ex.plan}</div>
    <div class="as-ex-eq">${ex.eq}</div>
    ${!isCardioEx(ex)?`
    <div class="as-weight-row">
      <button class="as-w-btn" id="as-w-dn">âˆ’</button>
      <div class="as-w-val">${w}<span class="as-w-unit"> kg</span></div>
      <button class="as-w-btn" id="as-w-up">+</button>
    </div>
    <div class="as-sets-grid">
      ${Array.from({length:planSets},(_,si)=>`
        <div class="as-set-btn${completedSets[si]?' done':''}" data-set="${si}">
          <div class="as-set-label">Set ${si+1}</div>
          <div class="as-set-val">${completedSets[si]?'âœ“':planReps+' reps'}</div>
        </div>`).join('')}
    </div>`:
    `<div style="text-align:center;padding:40px 0">
      <div style="font-size:60px;margin-bottom:16px">ğŸƒ</div>
      <div style="font-size:18px;font-weight:700;color:var(--text3)">Cardio Exercise</div>
      <div style="font-size:14px;color:var(--text3);margin-top:6px">Check HR tracker for Zone 2</div>
    </div>`}
    <div class="as-tip-box">
      <div class="as-tip-lbl">Coach's Cue</div>
      <div class="as-tip-text">${ex.tip}</div>
    </div>`;

  if(!isCardioEx(ex)){
    body.querySelector('#as-w-dn').addEventListener('click',()=>{
      const inc=ex.increment||2.5;
      sessionState.weights[exIdx]=Math.max(0,(sessionState.weights[exIdx]||0)-inc);
      renderActiveExercise();
    });
    body.querySelector('#as-w-up').addEventListener('click',()=>{
      const inc=ex.increment||2.5;
      sessionState.weights[exIdx]=(sessionState.weights[exIdx]||0)+inc;
      // Track PR
      const last=S.bodyLogs[S.bodyLogs.length-1];
      const bw=last?last.weight:85;
      sessionBurn+=calcSetKcal(ex,sessionState.weights[exIdx],planReps,bw);
      renderActiveExercise();
    });
    body.querySelectorAll('.as-set-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const si=parseInt(btn.dataset.set);
        if(!sessionState.completedSets[exIdx]) sessionState.completedSets[exIdx]={};
        sessionState.completedSets[exIdx][si]=!sessionState.completedSets[exIdx][si];
        const last=S.bodyLogs[S.bodyLogs.length-1]; const bw=last?last.weight:85;
        if(sessionState.completedSets[exIdx][si]) sessionBurn+=calcSetKcal(ex,w,planReps,bw);
        renderActiveExercise();
      });
    });
  }

  document.getElementById('as-prev-btn').disabled=exIdx===0;
  document.getElementById('as-next-btn').textContent=exIdx===total-1?'Finish âœ“':'Next â†’';
}

document.getElementById('as-prev-btn').addEventListener('click',()=>{
  if(sessionState.exIdx>0){ sessionState.exIdx--; renderActiveExercise(); }
});
document.getElementById('as-next-btn').addEventListener('click',()=>{
  const {wo,exIdx}=sessionState;
  if(exIdx<wo.exercises.length-1){
    // Update PR if weight improved
    const ex=wo.exercises[exIdx];
    const w=sessionState.weights[exIdx]||0;
    if(w>0 && w>(S.exercisePR[ex.n]||0)){ S.exercisePR[ex.n]=w; save(); showToast(`PR! ${ex.n}: ${w}kg ğŸ‰`); }
    sessionState.exIdx++;
    renderActiveExercise();
    // Rest timer for compound lifts
    if(!isCardioEx(ex)){
      const next=wo.exercises[sessionState.exIdx];
      startRestTimer(next.n);
    }
  } else {
    finishSession();
  }
});

document.getElementById('as-close').addEventListener('click',()=>{
  clearInterval(sessionTimer);
  document.getElementById('active-session').className='';
});

let restTimer=null;
function startRestTimer(nextName) {
  const overlay=document.getElementById('rest-overlay');
  document.getElementById('rest-next-info').textContent='Next: '+nextName;
  overlay.classList.add('show');
  let remaining=120;
  document.getElementById('rest-countdown').textContent='02:00';
  clearInterval(restTimer);
  restTimer=setInterval(()=>{
    remaining--;
    const m=Math.floor(remaining/60), s=remaining%60;
    document.getElementById('rest-countdown').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    if(remaining<=0){ clearInterval(restTimer); overlay.classList.remove('show'); }
  },1000);
}
document.getElementById('rest-skip').addEventListener('click',()=>{ clearInterval(restTimer); document.getElementById('rest-overlay').classList.remove('show'); });

function finishSession() {
  clearInterval(sessionTimer);
  document.getElementById('active-session').className='';
  const {wo}=sessionState;
  S.burnLog[today()]=(S.burnLog[today()]||0)+sessionBurn;
  if(!S.workoutLog[today()]) S.workoutLog[today()]={};
  wo.exercises.forEach((_,i)=>{ S.workoutLog[today()][wo.name+'-'+i]=true; });
  if(S.streakLast!==today()){ S.streak++; S.streakLast=today(); }
  save();
  const sc=document.getElementById('session-complete');
  sc.classList.add('show');
  document.getElementById('sc-stats').innerHTML=`
    <div style="display:flex;justify-content:space-around;text-align:center">
      <div><div style="font-size:28px;font-weight:900;color:var(--accent)">${Math.floor(sessionSec/60)}m</div><div style="font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.3px">Duration</div></div>
      <div><div style="font-size:28px;font-weight:900;color:var(--green)">${sessionBurn}</div><div style="font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.3px">kcal</div></div>
      <div><div style="font-size:28px;font-weight:900;color:var(--blue)">${wo.exercises.length}</div><div style="font-size:11px;color:var(--text3);font-weight:600;text-transform:uppercase;letter-spacing:.3px">Exercises</div></div>
    </div>`;
}
document.getElementById('sc-done-btn').addEventListener('click',()=>{
  document.getElementById('session-complete').classList.remove('show');
  renderWorkout();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CALORIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderCalories() {
  const now=new Date();
  document.getElementById('cal-date-lbl').textContent=now.toLocaleDateString('en-US',{weekday:'long',day:'numeric',month:'long'});
  // Toggle veg/non-veg day pill
  const dayType=now.getDay()%2===0?'Veg Day':'Non-Veg Day';
  document.getElementById('cal-day-type').textContent=dayType;

  const tot=todayTotals();
  const burn=todayBurn();
  const tgt=S.calTarget||{kcal:2200,p:110,c:303,f:61};
  const pTgt=tgt.p||110, cTgt=tgt.c||303, fTgt=tgt.f||61;
  const remain=Math.max(0,tgt.kcal+burn-tot.kcal);
  const pct=Math.min(100,Math.round(tot.kcal/(tgt.kcal||2200)*100));

  document.getElementById('cal-remain').textContent=remain;
  document.getElementById('cal-eaten').textContent=tot.kcal||0;
  document.getElementById('cal-burned-txt').textContent=burn||0;
  document.getElementById('ring-pct').textContent=pct+'%';

  // Rings
  const calFrac=Math.min(1,tot.kcal/(tgt.kcal||2200));
  const pFrac=Math.min(1,tot.p/(pTgt||110));
  document.getElementById('ring-arc2').style.strokeDashoffset=515-(515*calFrac);
  document.getElementById('ring-protein').style.strokeDashoffset=377-(377*pFrac);

  // Macro bars
  document.getElementById('val-p').textContent=tot.p||0;
  document.getElementById('tgt-p').textContent=pTgt;
  document.getElementById('bar-p').style.width=Math.min(100,((tot.p||0)/pTgt*100))+'%';
  document.getElementById('val-c').textContent=tot.c||0;
  document.getElementById('tgt-c').textContent=cTgt;
  document.getElementById('bar-c').style.width=Math.min(100,((tot.c||0)/cTgt*100))+'%';
  document.getElementById('val-f').textContent=tot.f||0;
  document.getElementById('tgt-f').textContent=fTgt;
  document.getElementById('bar-f').style.width=Math.min(100,((tot.f||0)/fTgt*100))+'%';

  // TDEE breakdown
  const bmr=calcBMR(), neat=calcNEAT(), tdee=bmr+neat+burn;
  document.getElementById('tdb-target').textContent=tgt.kcal+' kcal';
  document.getElementById('tdb-bmr').textContent=bmr+' kcal';
  document.getElementById('tdb-neat').textContent='~'+neat+' kcal';
  document.getElementById('tdb-workout').textContent=burn+' kcal';
  document.getElementById('tdb-total').textContent=tdee+' kcal';

  renderQuickFoods();
  renderFoodLog();
}

function renderQuickFoods() {
  const grid=document.getElementById('qfood-grid');
  grid.innerHTML='';
  QUICK_FOODS.forEach(f=>{
    const card=document.createElement('div');
    card.className='qfood-card';
    card.innerHTML=`<div class="qfood-icon">${f.icon}</div><div class="qfood-name">${f.name}</div><div class="qfood-kcal">${f.kcal} kcal</div><div class="qfood-macros">P:${f.p}g C:${f.c}g F:${f.f}g</div>`;
    card.addEventListener('click',()=>{
      if(!S.calLog[today()]) S.calLog[today()]=[];
      S.calLog[today()].push({...f,id:Date.now()});
      save(); renderCalories(); showToast(f.name+' added');
    });
    grid.appendChild(card);
  });
}

function renderFoodLog() {
  const list=document.getElementById('food-log-list');
  const foods=todayCalLog();
  if(!foods.length){
    list.innerHTML='<div style="color:var(--text3);font-size:13px;text-align:center;padding:28px;background:var(--card);border-radius:var(--r-lg);border:1px solid var(--border3)">No food logged yet</div>';
    return;
  }
  list.innerHTML='';
  foods.forEach((f,i)=>{
    const item=document.createElement('div');
    item.className='food-log-item';
    item.innerHTML=`<div class="food-log-info"><div class="food-log-name">${f.name||'Food'}</div><div class="food-log-macros">P:${f.p||0}g Â· C:${f.c||0}g Â· F:${f.f||0}g</div></div><div class="food-log-kcal">${f.kcal||0}</div><button class="food-log-del" data-i="${i}">Ã—</button>`;
    item.querySelector('.food-log-del').addEventListener('click',()=>{
      S.calLog[today()].splice(i,1); save(); renderCalories();
    });
    list.appendChild(item);
  });
}

document.getElementById('food-save').addEventListener('click',()=>{
  const name=document.getElementById('f-name').value;
  const kcal=parseInt(document.getElementById('f-kcal').value)||0;
  const p=parseInt(document.getElementById('f-p').value)||0;
  const c=parseInt(document.getElementById('f-c').value)||0;
  const f=parseInt(document.getElementById('f-f').value)||0;
  if(!kcal){showToast('Enter calories');return;}
  if(!S.calLog[today()]) S.calLog[today()]=[];
  S.calLog[today()].push({name:name||'Custom Food',kcal,p,c,f,id:Date.now()});
  save(); closeSheets(); renderCalories(); showToast('Food added!');
  ['f-name','f-kcal','f-p','f-c','f-f'].forEach(id=>document.getElementById(id).value='');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('report-tabs').addEventListener('click',e=>{
  const tab=e.target.closest('.r-tab');
  if(!tab) return;
  document.querySelectorAll('.r-tab').forEach(t=>t.classList.remove('active'));
  tab.classList.add('active');
  renderReports(tab.dataset.period);
});

function getLogsForPeriod(period) {
  const now=new Date(); const today2=now.toISOString().slice(0,10);
  const days={'week':7,'month':30,'quarter':90,'year':365}[period]||7;
  const result=[];
  for(let i=0;i<days;i++){
    const d=new Date(now); d.setDate(d.getDate()-i);
    const key=d.toISOString().slice(0,10);
    const foods=S.calLog[key]||[];
    const totals=foods.reduce((a,f)=>{a.kcal+=f.kcal||0;a.p+=f.p||0;a.c+=f.c||0;a.f+=f.f||0;return a},{kcal:0,p:0,c:0,f:0});
    result.push({date:key,consumed:totals.kcal,burned:S.burnLog[key]||0});
  }
  return result.reverse();
}

function renderReports(period) {
  const logs=getLogsForPeriod(period);
  const bmr=calcBMR(); const neat=calcNEAT();
  const tgt=S.calTarget||{kcal:2200};
  const totalConsumed=logs.reduce((a,l)=>a+l.consumed,0);
  const totalBurned=logs.reduce((a,l)=>a+l.burned,0);
  const totalBMR=bmr*logs.length;
  const deficit=totalBMR+neat*logs.length+totalBurned-totalConsumed;

  document.getElementById('deficit-num').textContent=Math.round(deficit).toLocaleString();
  document.getElementById('r-consumed').textContent=Math.round(totalConsumed/logs.length||0)+'avg';
  document.getElementById('r-burned').textContent=totalBurned;
  document.getElementById('r-bmr').textContent=Math.round(totalBMR);
  document.getElementById('weight-chart-title').textContent=period.charAt(0).toUpperCase()+period.slice(1)+' Weight';
  document.getElementById('deficit-sub').textContent=deficit>0?`~${(deficit/7700).toFixed(2)}kg estimated fat loss`:'Maintain deficit for fat loss';

  // KPIs
  const kpiGrid=document.getElementById('report-kpis');
  const bodyLogs=S.bodyLogs||[];
  const first=bodyLogs[0]; const last2=bodyLogs[bodyLogs.length-1];
  const wLost=first&&last2?(first.weight-last2.weight).toFixed(1):0;
  const avgSleep=bodyLogs.length?bodyLogs.reduce((a,l)=>a+(l.sleep||0),0)/bodyLogs.length:0;
  const rhrFirst=bodyLogs.find(l=>l.rhr>0);
  const rhrLast=bodyLogs.slice().reverse().find(l=>l.rhr>0);
  const rhrDelta=rhrFirst&&rhrLast?(rhrLast.rhr-rhrFirst.rhr):0;
  kpiGrid.innerHTML=`
    <div class="kpi-card"><div class="kpi-label">Total Lost</div><div class="kpi-val">${wLost}kg</div><div class="kpi-delta ${wLost>0?'pos':''}">${wLost>0?'â–¼ Progress made':'Start logging'}</div></div>
    <div class="kpi-card"><div class="kpi-label">Avg Sleep</div><div class="kpi-val">${avgSleep.toFixed(1)}h</div><div class="kpi-delta ${avgSleep>=7?'pos':'neg'}">${avgSleep>=7?'â–² On target':'â–¼ Under 7h'}</div></div>
    <div class="kpi-card"><div class="kpi-label">Resting HR</div><div class="kpi-val">${rhrLast?rhrLast.rhr+'bpm':'â€”'}</div><div class="kpi-delta ${rhrDelta<0?'pos':'neg'}">${rhrDelta!==0?(rhrDelta<0?'â–¼ Improving':'â–² Check sleep'):''}</div></div>
    <div class="kpi-card"><div class="kpi-label">Streak</div><div class="kpi-val">${S.streak}d</div><div class="kpi-delta pos">Keep going!</div></div>`;

  // Weight chart
  const wLogs=S.bodyLogs||[];
  const svg=document.getElementById('weight-chart');
  svg.innerHTML='';
  if(wLogs.length>=2){
    const W=340, H=180, pad=20;
    const weights=wLogs.map(l=>l.weight);
    const minW=Math.min(...weights)-1, maxW=Math.max(...weights)+1;
    const pts=wLogs.map((l,i)=>{
      const x=pad+(W-pad*2)*i/(wLogs.length-1);
      const y=H-pad-(H-pad*2)*(l.weight-minW)/(maxW-minW);
      return`${x},${y}`;
    });
    svg.innerHTML=`
      <polyline points="${pts.join(' ')}" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
      ${wLogs.map((l,i)=>{const [x,y]=pts[i].split(',');return`<circle cx="${x}" cy="${y}" r="4" fill="var(--accent)"/>`}).join('')}
      <text x="${pad}" y="${H-4}" fill="var(--text3)" font-size="11" font-family="Figtree,sans-serif">${minW.toFixed(1)}</text>
      <text x="${pad}" y="${pad+4}" fill="var(--text3)" font-size="11" font-family="Figtree,sans-serif">${maxW.toFixed(1)}</text>`;
  } else {
    svg.innerHTML='<text x="170" y="90" text-anchor="middle" fill="var(--text3)" font-size="13" font-family="Figtree,sans-serif">Log body stats to see chart</text>';
  }

  // Exercise PRs
  const prList=document.getElementById('ex-prog-list');
  const prs=Object.entries(S.exercisePR||{}).filter(([,v])=>v>0).slice(0,4);
  prList.innerHTML=prs.length?prs.map(([name,w])=>`
    <div class="ex-prog-card">
      <div class="ex-prog-name">${name}</div>
      <div class="ex-prog-row">
        <div class="ex-prog-num">${w}kg</div>
        <div class="ex-prog-lbl">Personal Record</div>
      </div>
    </div>`).join(''):'<div style="padding:0 16px"><div class="chart-card" style="text-align:center;color:var(--text3);font-size:13px">Complete sessions to see PRs</div></div>';

  // Body chart placeholder
  const bsvg=document.getElementById('body-chart');
  bsvg.innerHTML='<text x="170" y="80" text-anchor="middle" fill="var(--text3)" font-size="13" font-family="Figtree,sans-serif">Log waist & HR to see trends</text>';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROFILE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderProfile() {
  const last=S.bodyLogs[S.bodyLogs.length-1];
  const grid=document.getElementById('body-metrics');
  grid.innerHTML=`
    <div class="body-metric-card"><div class="bm-icon">âš–ï¸</div><div class="bm-val">${last?last.weight:'â€”'}<span class="bm-unit"> kg</span></div><div class="bm-lbl">Weight</div><div class="bm-sub">${last?'Logged '+new Date(last.date).toLocaleDateString():'Not logged'}</div></div>
    <div class="body-metric-card"><div class="bm-icon">ğŸ“</div><div class="bm-val">${last&&last.waist?last.waist:'â€”'}<span class="bm-unit"> in</span></div><div class="bm-lbl">Waist</div><div class="bm-sub">Goal: 27 inches</div></div>
    <div class="body-metric-card"><div class="bm-icon">â¤ï¸</div><div class="bm-val">${last&&last.rhr?last.rhr:'â€”'}<span class="bm-unit"> bpm</span></div><div class="bm-lbl">Resting HR</div><div class="bm-sub">Goal: 55â€“60 bpm</div></div>
    <div class="body-metric-card"><div class="bm-icon">ğŸŒ™</div><div class="bm-val">${last&&last.sleep?last.sleep:'â€”'}<span class="bm-unit"> h</span></div><div class="bm-lbl">Sleep</div><div class="bm-sub">Min 7h â€” non-negotiable</div></div>`;

  // Push-ups
  document.getElementById('pushup-val').textContent=S.pushups;

  // Progress bars
  const startW=92, goalW=70;
  const curW=last?last.weight:92;
  const wPct=Math.min(100,Math.max(0,(startW-curW)/(startW-goalW)*100));
  document.getElementById('prog-w').style.width=wPct+'%';
  document.getElementById('prog-w-lbl').textContent=`${curW} â†’ ${goalW} kg`;
  const startWs=38, goalWs=27;
  const curWs=last&&last.waist?last.waist:38;
  const wsPct=Math.min(100,Math.max(0,(startWs-curWs)/(startWs-goalWs)*100));
  document.getElementById('prog-ws').style.width=wsPct+'%';

  updateSettingsDisplay();
  renderPhaseTargetsCard();
  renderMilestones();
  renderRoadmapCard();
}

document.getElementById('pu-up').addEventListener('click',()=>{ S.pushups=Math.min(200,S.pushups+1); save(); document.getElementById('pushup-val').textContent=S.pushups; });
document.getElementById('pu-dn').addEventListener('click',()=>{ S.pushups=Math.max(0,S.pushups-1); save(); document.getElementById('pushup-val').textContent=S.pushups; });

document.getElementById('log-body-btn').addEventListener('click',()=>openSheet('body-sheet'));
document.getElementById('body-save').addEventListener('click',()=>{
  const w=parseFloat(document.getElementById('bl-w').value);
  if(!w){showToast('Enter weight');return;}
  const ws=parseFloat(document.getElementById('bl-ws').value)||0;
  const rhr=parseInt(document.getElementById('bl-rhr').value)||0;
  const sl=parseFloat(document.getElementById('bl-sl').value)||0;
  S.bodyLogs.push({date:today(),weight:w,waist:ws,rhr,sleep:sl});
  save(); closeSheets(); renderProfile();
  showToast('Stats saved!');
  // Check if weight suggest is needed
  if(S.bodyLogs.length>=7) checkWeightSuggest();
});

function checkWeightSuggest() {
  const recent=S.bodyLogs.slice(-7);
  const avgW=recent.reduce((a,l)=>a+l.weight,0)/recent.length;
  const curTgt=S.calTarget||{kcal:2200};
  const sugTgt=getCalTargetForWeight(Math.round(avgW));
  if(Math.abs(sugTgt.kcal-curTgt.kcal)>80){
    document.getElementById('wss-avg-weight').textContent=avgW.toFixed(1)+' kg';
    document.getElementById('wss-cur-kcal').textContent=curTgt.kcal+' kcal';
    document.getElementById('wss-new-kcal').textContent=sugTgt.kcal+' kcal';
    document.getElementById('wss-macro-preview').textContent=`Suggested macros: P:${sugTgt.p}g Â· C:${sugTgt.c}g Â· F:${sugTgt.f}g`;
    openSheet('weight-suggest-sheet');
  }
}
document.getElementById('wss-apply').addEventListener('click',()=>{
  const recent=S.bodyLogs.slice(-7);
  const avgW=recent.reduce((a,l)=>a+l.weight,0)/recent.length;
  S.calTarget=getCalTargetForWeight(Math.round(avgW));
  save(); closeSheets(); updateSettingsDisplay(); showToast('Targets updated!');
});
document.getElementById('wss-dismiss').addEventListener('click',closeSheets);

// â”€â”€ SETTINGS â”€â”€
document.getElementById('cal-target-row').addEventListener('click',()=>openSheet('cal-target-sheet'));
document.getElementById('plan-phase-row').addEventListener('click',()=>{ renderPhaseOptionsInSheet(); openSheet('phase-sheet'); });
document.getElementById('view-targets-row').addEventListener('click',()=>{ renderTargetPhaseSelect(); renderTargetPhasePreview(S.planPhase||1); openSheet('targets-sheet'); });
document.getElementById('target-phase-select').addEventListener('change',function(){ renderTargetPhasePreview(parseInt(this.value)); });

document.getElementById('cal-preset-select').addEventListener('change',function(){
  const v=this.value;
  document.getElementById('cal-custom-fields').style.display=v?'block':'none';
  if(v&&v!=='custom'){
    const [kcal,protein,carbs,fat]=v.split('|').map(Number);
    document.getElementById('ct-kcal').value=kcal; document.getElementById('ct-p').value=protein;
    document.getElementById('ct-c').value=carbs; document.getElementById('ct-f').value=fat;
  }
});

document.getElementById('cal-target-save').addEventListener('click',()=>{
  const kcal=parseInt(document.getElementById('ct-kcal').value)||S.calTarget?.kcal||2200;
  const protein=parseInt(document.getElementById('ct-p').value)||S.calTarget?.p||110;
  const carbs=parseInt(document.getElementById('ct-c').value)||S.calTarget?.c||303;
  const fat=parseInt(document.getElementById('ct-f').value)||S.calTarget?.f||61;
  S.calTarget={kcal,p:protein,c:carbs,f:fat}; save(); updateSettingsDisplay(); renderPhaseTargetsCard(); closeSheets(); showToast('Targets saved!');
});

function updateSettingsDisplay() {
  const ph=getCurrentPhase(); const t=S.calTarget||{kcal:ph.kcal,p:ph.protein,c:ph.carbs,f:ph.fat};
  const pVal=t.p||t.protein||0; const cVal=t.c||t.carbs||0; const fVal=t.f||t.fat||0;
  document.getElementById('cal-target-sub').textContent=`${t.kcal.toLocaleString()} kcal Â· P:${pVal}g C:${cVal}g F:${fVal}g`;
  document.getElementById('plan-phase-sub').textContent=`Year ${ph.year} Â· Month ${ph.months} Â· ${ph.name}`;
}

function renderPhaseTargetsCard() {
  const ph=getCurrentPhase();
  const container=document.getElementById('phase-targets-card');
  container.innerHTML=`<div class="phase-card">
    <div class="phase-card-hdr">
      <div class="phase-card-title">Phase ${ph.id} â€” ${ph.name}</div>
      <div class="phase-card-sub">Year ${ph.year} Â· Month ${ph.months}<br>${ph.focus}</div>
    </div>
    <div class="phase-targets-grid">
      <div class="phase-target-item"><div class="phase-target-item-val">${ph.weight}</div><div class="phase-target-item-lbl">Target Weight</div></div>
      <div class="phase-target-item"><div class="phase-target-item-val">${ph.kcal.toLocaleString()} kcal</div><div class="phase-target-item-lbl">Daily Calories</div></div>
      <div class="phase-target-item"><div class="phase-target-item-val">${ph.protein}g P Â· ${ph.carbs}g C</div><div class="phase-target-item-lbl">Protein Â· Carbs</div></div>
      <div class="phase-target-item"><div class="phase-target-item-val">${ph.cardio}</div><div class="phase-target-item-lbl">Cardio Target</div></div>
    </div>
  </div>`;
}

function renderRoadmapCard() {
  const container=document.getElementById('roadmap-card');
  const cur=S.planPhase||1;
  container.innerHTML=PLAN_PHASES.map(ph=>{
    const isPast=ph.id<cur, isCur=ph.id===cur;
    return `<div class="roadmap-row${isCur?' current':''}">
      <div style="width:10px;height:10px;border-radius:50%;background:${isPast?'var(--green)':isCur?'var(--accent)':'var(--fill2)'};margin-top:4px;flex-shrink:0;${isCur?'box-shadow:0 0 8px var(--accent)':''}"></div>
      <div style="flex:1;min-width:0;margin-left:12px">
        <div style="display:flex;align-items:center;gap:6px;margin-bottom:3px">
          <div style="font-size:13px;font-weight:700;color:${isCur?'var(--accent)':isPast?'var(--text3)':'var(--text)'}">Phase ${ph.id} â€” ${ph.name}${isPast?' âœ“':''}</div>
          ${isCur?'<span class="pill pill-accent" style="font-size:9px;padding:2px 7px">Now</span>':''}
        </div>
        <div style="font-size:11px;color:var(--text3)">Y${ph.year} Â· M${ph.months} Â· ${ph.kcal.toLocaleString()} kcal Â· ${ph.weight}</div>
      </div>
    </div>`;
  }).join('');
}

function renderMilestones() {
  const list=document.getElementById('milestones-list');
  list.innerHTML='';
  const curW=(S.bodyLogs[S.bodyLogs.length-1]?.weight)||92;
  MILESTONES.forEach(m=>{
    const targetW=parseFloat(m.weight.split('â€“')[1]||m.weight)||92;
    let status='future';
    if(curW<=targetW+1) status='current';
    if(curW<targetW-2) status='achieved';
    const el=document.createElement('div');
    el.className=`milestone-card ${status==='achieved'?'achieved':status==='current'?'current-phase':'future'}`;
    el.innerHTML=`
      <div class="milestone-badge ${status}">${status==='achieved'?'âœ“ Done':status==='current'?'â— Now':'â—‹ Future'}</div>
      <div class="milestone-period">${m.period}</div>
      <div class="milestone-title">${m.weight} Â· ${m.waist}</div>
      <div style="font-size:12px;color:var(--text3);margin:4px 0">${m.cardio}</div>
      <div style="font-size:12px;color:var(--text2);margin-top:6px;line-height:1.5;font-style:italic">${m.look}</div>`;
    list.appendChild(el);
  });
}

function renderPhaseOptionsInSheet() {
  const container=document.getElementById('phase-options');
  container.innerHTML='';
  const cur=S.planPhase||1;
  PLAN_PHASES.forEach(ph=>{
    const el=document.createElement('div');
    el.className='phase-option-card'+(ph.id===cur?' selected':'');
    el.innerHTML=`<div class="phase-option-year">Year ${ph.year} Â· Month ${ph.months}</div><div class="phase-option-name">Phase ${ph.id} â€” ${ph.name}</div><div class="phase-option-months">${ph.focus}</div>`;
    el.addEventListener('click',()=>{
      S.planPhase=ph.id;
      S.calTarget={kcal:ph.kcal,p:ph.protein,c:ph.carbs,f:ph.fat};
      S.phaseStartDate=today();
      save(); updateSettingsDisplay(); renderPhaseTargetsCard(); renderMilestones(); closeSheets();
      showToast(`Phase ${ph.id}: ${ph.name}`);
    });
    container.appendChild(el);
  });
}

function renderTargetPhaseSelect() {
  const sel=document.getElementById('target-phase-select');
  const curId=S.planPhase||1;
  sel.innerHTML=PLAN_PHASES.map(ph=>`<option value="${ph.id}" ${ph.id===curId?'selected':''}>Phase ${ph.id}: ${ph.name} Â· Y${ph.year} M${ph.months}</option>`).join('');
}

function renderTargetPhasePreview(phaseId) {
  const container=document.getElementById('target-phase-preview');
  const ph=PLAN_PHASES.find(p=>p.id===phaseId)||PLAN_PHASES[0];
  container.innerHTML=`<div class="phase-card">
    <div class="phase-card-hdr">
      <div class="phase-card-title">Phase ${ph.id} â€” ${ph.name}</div>
      <div class="phase-card-sub">Year ${ph.year} Â· Month ${ph.months}</div>
    </div>
    <div class="phase-targets-grid">
      <div class="phase-target-item"><div class="phase-target-item-val">${ph.kcal.toLocaleString()} kcal</div><div class="phase-target-item-lbl">Calories</div></div>
      <div class="phase-target-item"><div class="phase-target-item-val">${ph.protein}g</div><div class="phase-target-item-lbl">Protein</div></div>
      <div class="phase-target-item"><div class="phase-target-item-val">${ph.weight}</div><div class="phase-target-item-lbl">Weight Target</div></div>
      <div class="phase-target-item"><div class="phase-target-item-val">${ph.waist}</div><div class="phase-target-item-lbl">Waist Target</div></div>
      <div class="phase-target-item" style="grid-column:span 2"><div class="phase-target-item-val" style="font-size:13px">${ph.cardio}</div><div class="phase-target-item-lbl">Cardio</div></div>
    </div>
  </div>`;
}

// Phase up banner
function checkPhaseUpBanner() {
  const banner=document.getElementById('phase-up-banner');
  if(!S.phaseStartDate||!S.planPhase||S.planPhase>=PLAN_PHASES.length){banner.style.display='none';return;}
  const daysSince=Math.floor((new Date()-new Date(S.phaseStartDate))/86400000);
  if(daysSince>=90){
    banner.style.display='block';
    document.getElementById('phase-up-text').textContent=`You've been on Phase ${S.planPhase} for ${daysSince} days. Time to advance!`;
  } else { banner.style.display='none'; }
}
document.getElementById('phase-up-dismiss').addEventListener('click',()=>{ document.getElementById('phase-up-banner').style.display='none'; });
document.getElementById('phase-up-btn').addEventListener('click',()=>{
  if(S.planPhase<PLAN_PHASES.length){
    S.planPhase++; const ph=getCurrentPhase();
    S.calTarget={kcal:ph.kcal,p:ph.protein,c:ph.carbs,f:ph.fat};
    S.phaseStartDate=today(); save();
    document.getElementById('phase-up-banner').style.display='none';
    updateSettingsDisplay(); renderPhaseTargetsCard(); renderMilestones();
    showToast(`Advanced to Phase ${S.planPhase}! ğŸš€`);
  }
});

// Notifications
document.getElementById('notif-toggle').addEventListener('change',function(){
  if(this.checked && 'Notification' in window){
    Notification.requestPermission().then(p=>{
      document.getElementById('notif-status').textContent=p==='granted'?'Reminders active':'Permission denied';
    });
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderHome();
renderWorkout();
updateSettingsDisplay();
renderPhaseTargetsCard();
renderMilestones();
renderRoadmapCard();
checkPhaseUpBanner();
setInterval(()=>{ if(currentPage==='home') renderGymTime(); }, 30000);
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/TrnX/sw.js')
      .then(reg => console.log('SW registered:', reg.scope))
      .catch(err => console.warn('SW registration failed:', err));
  });
}
</script>
</body>
</html>
